<!doctype html>
<html lang="fr">
    <head>
        <meta charset="utf-8">

        <title>Tester √† travers OpenAPI, ou comment valider votre documentation ! - Forum PHP 2022 - St√©phane HULARD / CHStudio</title>

        <meta name="description" content="Aujourd'hui les APIs sont partout, les documenter correctement est un pr√©requis pour qu'elles soient utilis√©es correctement. Cependant un probl√®me reste pr√©sent quand on a affaire √† de la doc : comment garantir qu'elle est √† jour ou que le code l'impl√©mente correctement ?">
        <meta name="author" content="St√©phane HULARD">

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

        <link rel="stylesheet" href="../assets/reveal.js/css/reveal.css">
        <link rel="stylesheet" href="../assets/css/font-awesome.min.css">
        <link rel="stylesheet" href="../assets/css/theme.css" id="theme">

        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="../assets/css/tomorrow.css">

        <style type="text/css">
            body {
                height: calc(100vh - 202px);
            }
            .reveal .social-me {
                float: right;
            }
            .reveal .social-me img {
                margin-bottom: 0px;
            }
            .reveal .social-me a {
                color: #FFF;
                margin-right: 10px;
            }
            .reveal .social-me a:hover {
                color: rgba(4, 32, 41, 0.9);
            }
            .reveal .social-me a:last-child {
                margin-right: 0;
            }
            .right {
                text-align: right;
            }
            .bottom {
                margin-top: 35% !important;
            }
            .top {
                margin-bottom: 35% !important;
            }
            .left {
                text-align: left;
            }
            .center {
                text-align: center;
            }
            .float-right {
                float: right;
            }
            .background {
                background-color: rgba(255, 255, 255, 0.9) !important;
            }
            .no-background {
                background: none !important;
            }
            .border-radius {
                border-radius: 20px;
            }
            code.fragment {
                padding: 12px;
            }
            .reveal code a {
                color: rgb(65, 65, 65);
            }
            .full-height {
                max-height: unset !important;
            }
            .reveal {
                background-color: rgba(0, 174, 239, 0.8);
            }
            .reveal h1.highlight *, .reveal p.highlight>* {
                background-color: rgba(4, 32, 41, 0.9);
                display: inline;
                padding-left: 15px;
                padding-right: 15px;
            }
            .reveal h1.highlight *:last-child {
                line-height: 2em
            }
            .reveal section>p {
                font-size: 1.2em;
            }
            .reveal section>a>img.plain {
                margin: 23px 0;
                height: 94px;
            }
            .reveal section>a+a>img.plain {
                margin-right: 10px;
            }
            .reveal section.invert {
                color: rgba(0, 0, 0, 0.8);
            }
            .reveal pre {
                font-size: 2rem;
            }
            .reveal pre code {
                padding: 1rem 1.5rem;
            }

            .reveal section.invert p.highlight>* {
                background-color: rgba(255, 255, 255, 0.9)
            }
            .reveal figure.highlight {
                margin: 0;
                padding: 2rem 2.5rem;
                background-color: rgba(255, 255, 255, 0.9);
            }
            .reveal figure.highlight blockquote {
                box-shadow: none;
                padding: 0;
                margin: 0;
                margin-bottom: 2rem;
                font-size: 1.3em;
            }
            .reveal h1.highlight.white * {
                background-color: rgba(255, 255, 255, 0.9);
                color: rgba(0, 0, 0, 0.8);
            }
            .speaker-controls-notes .value {
                font-size: 1em !important;
            }

            .reveal .slide-background.present {
                opacity: 0.9;
            }

            .light-background .reveal .slide-background.present {
                opacity: 0.6;
            }

            .relative {
                position: relative;
            }
            .absolute {
                position: absolute !important;
                top: 0;
                left: 0;
            }
            .top120 {
                top: 120px;
            }

            @media print {
                .fragment.absolute {
                    display: none;
                }
            }
        </style>

        <!-- Printing and PDF exports -->
        <script>
            var link = document.createElement( 'link' );
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match( /print-pdf/gi ) ? '../assets/reveal.js/css/print/pdf.css' : '../assets/reveal.js/css/print/paper.css';
            document.getElementsByTagName( 'head' )[0].appendChild( link );
        </script>

        <!--[if lt IE 9]>
        <script src="../assets/reveal.js/lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>
        <div class="reveal concave center">
            <div class="slides">
                <section data-background-image="img/chameleon.jpg">
                    <h1 class="highlight white bottom" style="font-size: 2em;"><span>Tester √† travers <strong>OpenAPI</strong></span><br><small>ou comment valider votre documentation !</small></h1>
                    <p class="global-footer">
                        <a href="https://chstudio.fr"><img src="../../logo.png" width="20" class="plain" /></a>
                        <a href="https://phpconference.com"><img src="img/forumphp-2020-vecto.svg" height="20" class="plain" /></a>
                        <span>St√©phane Hulard&nbsp;-&nbsp;Forum PHP&nbsp;<time datetime="2022-10-14">2022</time></span>
                    </p>
                    <aside class="notes">
                        Merci de m'avoir rejoint pour ce talk autour des tests et de la documentation OpenAPI.
                        <br>
                        Je vais me pr√©senter rapidement, puis je ferais une petite introduction √† OpenAPI.
                        <br>
                        Je vous raconterai ensuite une petite histoire de projet et ce qui nous a amener √† envisager de tester notre documentation.
                        <br>
                        Je terminerai en vous parlant d'un projet que nous avons d√©velopp√© et mis en Open Source pour aider √† faire ces tests.
                        <br>
                        Il y aura pas mal de code sur la fin, n'h√©sitez pas √† revenir vers moi en posant des questions √† la fin ou ensuite si vous voulez aller plus loin ou √©clairer un d√©tail.
                    </aside>
                </section>
                <section class="invert">
                    <p class="social-me">
                        <img src="img/moi.jpg" class="plain" width="250"/>
                        <br/>
                        <a class="white" target="_blank" href="https://twitter.com/s_hulard">@s_hulard</a>
                        <br/>
                        <a class="white" target="_blank" href="https://chstudio.fr"><i class="fa fa-globe"></i></a>
                        <a class="white" target="_blank" href="https://www.linkedin.com/in/shulard"><i class="fa fa-linkedin"></i></a>
                        <a class="white" target="_blank" href="https://github.com/shulard"><i class="fa fa-github"></i></a>
                        <a class="white" target="_blank" href="https://gitlab.com/shulard"><i class="fa fa-gitlab"></i></a>
                    </p>
                    <h1 class="highlight left"><span>St√©phane Hulard</span></h1>
                    <p class="left highlight">
                        <span>ü§ì Directeur Technique <small>(<img src="../../logo.png" width="20" style="margin: 0" class="plain" /> CH Studio)</small></span>
                    </p>
                    <p class="left highlight">
                        <span>üéì Formateur</span>
                    </p>
                    <p class="left highlight">
                        <span>ü§ù Contributeur</span>
                    </p>
                    <aside class="notes">
                        Je suis St√©phane Hulard.
                        <br/>
                        ‚ñ∂ Je dirige une petite soci√©t√© qui s'appelle CH Studio. Nous sommes sp√©cialis√©s dans le d√©veloppement de projet PHP et nous aidons nos clients √† construire des projets solides et durables. Nous sommes souvent impliqu√©s sur le long terme et sommes donc sensibles √† la qualit√© pour notre propre bien √™tre. J'aime aussi beaucoup travailler sur des projets legacy pour aider les √©quipes √† les reprendres en main.
                        <br/>
                        Aujourd'hui nous travaillons principalement sur une application d'aggr√©gation et de recherche d'images m√©dicales. Nous ne d√©veloppons pas de site et sommes plus orient√©s vers les applications web.
                        <br/><br/>
                        ‚ñ∂ Je suis aussi formateur principalement autour des outils et m√©thodes li√©s √† la qualit√© logicielle.
                        <br/>
                        ‚ñ∂ Et enfin contributeur, pas autant que je le voudrais mais les projets open sources me permettent d'√©largir ma vision du m√©tier en b√©n√©ficiant de l'expertise et du soutien de la communaut√© ce qui est un atout pr√©cieux au quotidien¬≤.
                    </aside>
                </section>
<!--#########################################################################-->
                <section>
                    <section class="invert" data-background-image="img/relations.jpg">
                        <h1 class="highlight white"><span>OpenAPI ?</span></h1>
                        <aside class="notes">
                            Petit sondage avant de commencer, qui a d√©j√† utilis√© ou r√©dig√© une documentation OpenAPI ?
                            <br>
                            Bien, pour √™tre sur qu'on va bien se comprendre, je vais faire un petit tour de pr√©sentation.
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>Qu'est-ce que c'est ?</span></h1>
                        <p class="highlight"><span><strong>Objectif</strong>: Normaliser et standardiser la description d'APIs</span></p>
                        <p class="highlight fragment"><span><strong>2009</strong>: Swagger specification</span></p>
                        <p class="highlight fragment"><span><strong>2015</strong>: Initative OpenAPI</span></p>
                        <p class="highlight"><span class="fragment"><strong>2017</strong>: v3.0.0</span>&nbsp;<span class="fragment"><strong>2021</strong>: v3.1.0</span></p>
                        <p class="highlight fragment right"><img height="100" src="img/openapi.png" class="plain"></p>
                        <aside class="notes">
                            OpenAPI, globalement, √ßa permet de documenter vos APIs.
                            <br>
                            En 2009 nait la premi√®re version de ce qui deviendra la sp√©cification Swagger. C'est d'abord d√©velopp√© dans une soci√©t√© pour leur propre besoin de documentation.
                            <br>
                            L'id√©e a pris petit √† petit de l'ampleur, en 2011 la version 1.0 sort. L'anc√®tre d'OpenAPI est n√©. C'est la version 1.2 qui arrivera en 2014 qui commencera vraiment √† ressembler √† ce que vous pouvez utiliser aujourd'hui.
                            <br>
                            C'est cette version 1.2 qui va √™tre de plus en plus utilis√©. La version 2.0 suit et sort en 2014.
                            <br>
                            En 2015, Smart Bears une entreprise sp√©cialis√©e dans les tests d'API et le d√©veloppement s'int√©resse de pr√™t √† Swagger. Le cr√©ateur de la sp√©cification les rejoins et en d√©cembre, la sp√©cification est donn√© √† l'OpenAPI initiative qui est une organisation au sein de la Linux Foundation. C'est maintenant officiel, le projet prend son envol.
                            <br>
                            La premi√®re version d'OpenAPI se base donc sur Swagger 2.0. Les nouveaut√©s et avanc√©es se succ√®de, la version 3 sort en 2017, la version 3.1 en 2021‚Ä¶
                            <br>
                            C'est tout pour la petite histoire, √ßa permet au moins de situer les diff√©rents termes que vous pourriez retrouver dans les documentation. Il y a encore pas mal de projet qui s'appelle Swagger par exemple.
                            <!--
                                In 2009, Tony Tam of Wordnik (an online dictionary service) had begun working on what would become the Swagger Specification. Used to describe Wordnik's JSON API, Swagger was used to drive Wordnik's developer console / documentation (which can still be seen at https://developer.wordnik.com/docs), their server integration and code-generation within the company.

                                Initially known as SWAGR - "why WADL, when you can SWAGR?" said Wordnik colleague Zeke Sikelianos when discussing potential names for the project with Tam (though if SWAGR ever stood for anything, it appears to be lost in the mists of time) - Tam published the first version of the Swagger Specification (1.0) in August 2011, just one month after Mashery announced I/O Docs, though there had been at least a 0.1a version used internally.

                                While working at Reverb Technologies, Tam published version 1.1 of the Swagger Specification in August 2012. This was a minor refinement of the specification only.

                                Version 1.2 of the Swagger Specification was the first version written up as a formal specification document, in March 2014, separating the specification itself from the Swagger implementation. Improvements were made to the type system, to bring it more into line with JSON Schema Draft 4. This was the first version to gain widespread adoption across the API industry, and is still in use by some API providers today.

                                September 2014 saw the release of the Swagger Specification 2.0. This saw a reorganisation from the two-file format of Swagger 1.2 and earlier into a single document structure, but one that could still reference sub-documents using the JSON-Reference standard. Further improvements were made to the type system / JSON Schema support, fuller API metadata support with the contact and license objects, the use of markdown in descriptions was allowed and vendor extensions (now known as specification extensions) and response headers were supported among other more minor changes. Swagger 2.0 saw more growth and adoption across the industry, and the number of supporting commercial solutions and open-source offerings increased dramatically.

                                In March 2015, SmartBear Software, a leading API testing and development tool company, acquired the interests in the Swagger intellectual property and open-source projects from Reverb Technologies.

                                In September 2015, Tam joined SmartBear Software as VP of Products, Swagger.

                                In December 2015, the Swagger Specification was donated by SmartBear Software to a new open-governance organisation, set up under the auspices of the Linux Foundation: the OpenAPI Initiative (https://openapis.org).

                                Version 2.0 of the OpenAPI Specification (as it was now known) was identical to the Swagger 2.0 specification. Although there was, and remains, some confusion between the use of the terms Swagger and OpenAPI, this was a positive first step in the transition to the new governance body and the new name for the specification.
                            -->
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>Pourquoi ?</span></h1>
                        <p class="highlight"><span>Interop√©rabilit√©, </span><span>Automatisation, </span><span>Fiabilit√©.</span></p>
                        <aside class="notes">
                            Ok, maintenant on a vu que la sp√©cification d'API a pris de l'ampleur. Pourquoi autant d'int√©r√™t ?
                            <br>
                            Aujourd'hui la plupart des syst√®mes sur le web utilisent des APIs, on peut m√™me consid√©rer un site web comme une API.
                            <br>
                            ‚ñ∂ En effet, si on prend un peu de recul, tout syst√®me bas√© sur HTTP envoi des Requ√™tes et r√©cup√®re des R√©ponses.
                            <br>
                            Les d√©veloppeurs con√ßoivent des applications pour r√©pondre √† ces probl√©matiques. √ätre capable de savoir √† l'avance le format et avoir des exemples est un atout pr√©cieux.
                            <br>
                            ‚ñ∂ En plus, le format est facilement lisible par une machine ce qui permet d'automatiser la cr√©ation de client, la v√©rification ou tout autre action int√©ressante.
                            <br>
                            ‚ñ∂ On peut aboutir √† une meilleure fiabilit√© des syst√®mes et de leur utilisation en s'appuyant sur la description de leur comportement. Cette documentation devient un contrat.
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>Bonnes pratiques</span></h1>
                        <p class="highlight"><span>Design-First,</span><span>Single Source of Truth,</span><span>Source Control.</span></p>
                        <aside class="notes">
                            Deux approches existent code first et design first.

                            ‚ñ∂ Il existe des outils pour g√©n√©rer la doc √† partir des annotations. Si vous utilisez ce type d'annotation, ne stockez pas la version g√©n√©r√©e quelque part, charger la √† la demande.

                            ‚ñ∂ Pour ce dernier point, j'imagine qu'il n'y a pas de grosse surprise, j'imagine que tout le monde utilise un syst√®me de contr√¥le de version‚Ä¶
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>Un petit exemple</span></h1>
                        <pre style="font-size: 1.2rem" class="absolute top120">
                            <code class="yaml" data-line-numbers>// openapi.yaml
openapi: 3.1.0
info:
    version: "1.0.0"
    title: My Awesome API
servers:
    - url: 'http://localhost:8000'
      description: Local development server
paths:
    /api/users/me:
        $ref: users/me.yaml
components:
    securitySchemes:
        GESSO:
            type: apiKey
            in: header
            name: sso_uid
                            </code>
                        </pre>
                        <pre style="font-size: 1.2rem" class="absolute top120 fragment">
                            <code class="yaml" data-line-numbers="9-11">// openapi.yaml
openapi: 3.1.0
info:
    version: "1.0.0"
    title: My Awesome API
servers:
    - url: 'http://localhost:8000'
      description: Local development server
paths:
    /api/users/me:
        $ref: users/me.yaml
components:
    securitySchemes:
        GESSO:
            type: apiKey
            in: header
            name: sso_uid
                            </code>
                        </pre>
                        <pre style="font-size: 1.2rem" class="absolute top120 fragment fade-in">
                            <code class="yaml" data-line-numbers>// users/me.yaml
get:
    operationId: getCurrentUser
    summary: |
        Retrieve the logged user details.
    security:
        - GESSO: [ ]
    responses:
        '200':
            description: |
                Successfully retrieved the details of the logged in user
            content:
                'application/json':
                    schema:
                        $ref: 'schema/user.yaml#/User'


                            </code>
                        </pre>
                        <pre style="font-size: 1.2rem" class="absolute top120 fragment fade-in">
                            <code class="yaml" data-line-numbers="6,7">// users/me.yaml
get:
    operationId: getUserMe
    summary: |
        Retrieve the logged user details.
    security:
        - GESSO: [ ]
    responses:
        '200':
            description: |
                Successfully retrieved the details of the logged in user
            content:
                'application/json':
                    schema:
                        $ref: 'schema/user.yaml#/User'


                            </code>
                        </pre>
                        <pre style="font-size: 1.2rem" class="absolute top120 fragment fade-in">
                            <code class="yaml" data-line-numbers="9-15">// users/me.yaml
get:
    operationId: getUserMe
    summary: |
        Retrieve the logged user details.
    security:
        - GESSO: [ ]
    responses:
        '200':
            description: |
                Successfully retrieved the details of the logged in user
            content:
                'application/json':
                    schema:
                        $ref: 'schema/user.yaml#/User'


                            </code>
                        </pre>
                        <pre style="font-size: 1.2rem" class="absolute top120 fragment fade-in">
                            <code class="yaml" data-line-numbers>// users/schema/user.yaml
User:
    type: object
    required:
        - name
        - email
    properties:
        name:
            type: string
            example: Jane Doe
        updatedAt:
            type: string
            format: date
            example: 2017-07-21
        email:
            type: string
            example: example@ge.com
                            </code>
                        </pre>
                        <pre style="font-size: 1.2rem" class="absolute top120 fragment fade-in">
                            <code class="yaml" data-line-numbers="3-6,9,12,13,16">// users/schema/user.yaml
User:
    type: object
    required:
        - name
        - email
    properties:
        name:
            type: string
            example: Jane Doe
        updatedAt:
            type: string
            format: date
            example: 2017-07-21
        email:
            type: string
            example: example@ge.com
                            </code>
                        </pre>
                        <aside class="notes">
                            J'utilise volontairement le format YAML ici parce que je le trouve plus lisible mais c'est aussi possible de le faire en JSON. Le tout est de respecter la structure et les propri√©t√©s.
                            <br>
                            On commence avec le document de base, il y a une certaines quantit√©s d'informations. La version du sch√©ma utilis√©, ensuite un petit nom et une version, autant bien se pr√©senter.
                            <br>
                            Ensuite on trouve la liste des serveurs qui sont utilisables pour tester cette API. Cette information est tr√®s importante car la plupart des g√©n√©rateur de documentation vous permettront de faire les requ√™tes directement. On peut tester en quelques clics.
                            <br>
                            ‚ñ∂ Enfin, la partie la plus importante, la description des diff√©rentes URLs de votre API. On voit la pr√©sence du mot cl√© <code>$ref</code> qui d√©finit un fichier externe √† aller chercher.
                            <br>
                            On avance vers ce fichier qui d√©crit donc les diff√©rentes fa√ßon d'appeler notre URL pr√©c√©dente. On retrouve les diff√©rentes propri√©t√©s qui permettent de d√©crire notre API.
                            <br>
                            En premier, le verbe, ici on parle d'une requ√™te GET. Les diff√©rents champs de description permettent de rendre explicite √† quoi sert cette URL.
                            <br>
                            ‚ñ∂ Deuxi√®me point le champ <code>security</code> qui va d√©crire comment on doit √™tre connect√© pour acc√©der √† cette URL. On retrouve le nom du "composant" d√©crit dans le fichier openapi.yaml.
                            <br>
                            ‚ñ∂ Encore une fois on termine par le plus important, les diff√©rents formats de r√©ponse. J'omet beaucoup de points ici comme par exemple la description des param√®tres d'URL ou les informations dynamiques dans l'URL. L'objectif est juste que tout le monde sache de quoi on parle.
                            <br>
                            Pour les r√©ponses, on a une liste index√©e par le code de statut HTTP, ici 200. On va donc d√©crire une r√©ponse en succ√®s. On d√©termine le type mime de notre r√©ponse pour enfin pr√©senter le schema. On aura donc une r√©ponse au format JSON qui utilise un sch√©ma externe. Notez la pr√©sence d'un hash qui va pointer directement un des √©l√©ments pr√©sents dans le fichier.
                            <br>
                            Dans ce dernier fichier que je vais vous pr√©senter, on retrouve donc la description de ce qu'est un utilisateur, rien d'incroyable de prime abord, il est compos√© de trois propri√©t√©s, <code>name</code>, <code>updatedAt</code> et <code>email</code>.
                            <br>
                            ‚ñ∂ Mais quand on regarde plus en d√©tail, on voit qu'on peut exprimer des contraintes qui sont structurantes pour bien comprendre le fonctionnement. Certains champs sont obligatoires, certains respectent un certain format. Je sais donc √† quoi m'attendre quand j'appelle cette URL en √©tant authentifi√©.
                        </aside>
                    </section>
                </section>
                <section>
                    <section class="left" data-background-image="img/once-upon-a-time.jpg">
                        <h1 class="highlight white"><span>Il √©tait un projet d'API‚Ä¶</span></h1>
                        <p class="highlight right"><span>‚Ä¶ qui est un projet client aussi !</span></p>
                        <aside class="notes">
                            Je travaille avec depuis 2018 sur un projet assez important dans l'imagerie m√©dicale. On a une application Symfony, qui est utilis√©e pour fournir une API. Cette API est consomm√©e par un front √©crit en JavaScript et qui utilise Vue.js.
                            <br>
                            Le temps passe, les d√©veloppeurs aussi et finalement on se retrouve dans ce projet avec une bonne quantit√© de code l√©gacy. De premier abord je me dis, cool, c'est un indicateur que ce projet fonctionne. Ensuite je me rappelle que nous sommes en charge de son √©volution. On est donc responsable de faire avancer dans le bon sens. Je pr√©cise que je suis la depuis le d√©but du projet, je suis donc en grande partie responsable des incoh√©rences d'aujourd'hui !
                            <br>
                            Bref, cette API a souvent pr√©sent√© des incoh√©rences. Il y en a eu de plusieurs sortes, certaines venaient de bug dans l'impl√©mentation, d'autres venaient d'incompr√©hensions entre les d√©veloppeurs. L'un imagine une feature, l'autre aussi et souvent les visions ne sont pas compl√®tement partag√©es.
                            <br>
                            C'est un probl√®me qui avait √©t√© identifi√© il y a longtemps. On s'√©tait mis d'accord qu'il fallait plus documenter. Par facilit√©, on a commenc√© √† √©crire du Markdown pour pr√©senter nos APIs. Le markdown c'est pratique, relativement facile √† prendre en main, nous utilisons Gitlab au quotidien qui nous fait un beau rendu‚Ä¶ Cette documentation a v√©cu un petit moment et √† notre grande surprise, on s'est rendu compte qu'elle n'√©tait pas maintenue √† jour.
                            <br>
                            La bonne volont√© √©tait pr√©sente mais au final dans le rush du quotidien c'√©tait facile d'oublier‚Ä¶
                            <!--
                                Concr√®tement dans un projet

                                Workflow pour travailler sur un point d'API

                                Documentation √† plat compilable pour les humains

                                Cycle de vie par rapport au code, qui met √† jour quand ?
                            -->
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>üîß OpenAPI √† la rescousse !</span></h1>
                        <p class="highlight"><span>Un langage descriptif‚Ä¶</span><span class="fragment">‚Ä¶une suite d'outils !</span></p>
                        <aside class="notes">
                            Du coup au bout d'un moment avec notre documentation obsol√®te, nous avions toujours du mal √† sp√©cifier nos APIs et s'assurer qu'elles √©taient correctement impl√©ment√©es. On a d√©cid√© que le format Markdown n'√©tait pas super adapt√© pour une API, la bonne blague.
                            <br>
                            On s'est rapidement tourn√© vers OpenAPI qui propose toute une suite d'outils pour documenter correctement. La doc est √©crite dans un format technique, YAML ou JSON ce qui n'est pas un probl√®me pour l'√©quipe et permet d'exprimer clairement le fonctionnement. Avec les g√©n√©rateurs de documentation, on se retrouve avec de jolies pages web qui pr√©sente notre API beaucoup plus joliment que Gitlab ne le faisait.
                            <br>
                            ‚ñ∂ D√©mo time !
                            <br>
                            J'ai mis √† jour l'int√©gration continue pour g√©n√©rer une version HTML de la documentation qui est accessible par tous et plus facile √† lire qu'une s√©rie de fichiers YAML. L'API n'est pour l'instant pas compl√®tement document√©e avec OpenAPI mais √ßa avance et nous pouvons partager ce document avec d'autres √©quipes pour se synchroniser techniquement.
                            <br>
                            ‚ñ∂ J'ai aussi fait le choix de ne pas g√©n√©rer la documentation √† partir du code. Faire cette doc √† la main n'est pas le plus agr√©able mais une fois que les principaux √©l√©ments sont en place c'est comme des l√©gos qu'il faut penser √† indenter. Rappelons nous des bonnes pratique, Design First. L'objectif de notre utilisation d'OpenAPI est de pouvoir se mettre d'accord avant d'attaquer le d√©veloppement sur les URLs, les requ√™tes et les r√©ponses. On ne peut donc pas g√©n√©rer la doc √† partir du code.
                            <br>
                            Pourquoi ne pas l'avoir fait avant me direz vous ? Et bien je n'ai pas la r√©ponse, et en plus la doc en Markdown ce n'√©tait pas terrible. Parfois un nouvel outil vous ouvre les yeux et permet d'avancer.
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>‚ö†Ô∏è Divergence</span></h1>
                        <figure class="highlight">
                            <blockquote>Une documentation n'a de sens que si elle refl√®te l'√©tat actuel de l'application !</blockquote>
                            <figcaption>‚Äî Ma√Ætre Shifu, KungFu Panda 2008</figcaption>
                        </figure>
                        <aside class="notes">
                            Et oui, on est tous je pense tomb√© un jour dans ce pi√®ge. Quoi de plus inutile qu'une documentation qui ne correspond pas au comportement de l'application. Malgr√© nos efforts, le formalisme, il y avait toujours le risque que cette documentation en soit pas √† jour.
                            <br>
                            Je n'ai pas retrouv√© le nom de cette personne mais cette phrase raisonne encore dans ma t√™te.
                            <br>
                            Document√© un syst√®me fixe, qui n'√©volue plus est plus facile, pas de risque de divergence. Il fallait qu'on s'arme pour nous faire gagner du temps et fiabiliser tout √ßa.
                            <br>
                            Forc√©ment, le formalisme OpenAPI a permis √† tout un √©cosyst√®me d'outil de s'√©panouir. Je rappelle que la documentation est √©crite en YAML ou JSON et peut donc facilement √™tre pars√©e par un programme. J'ai parl√© de g√©n√©rateur de documentation mais il existe une toute autre cat√©gorie d'outils.
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>ü§ñ Mock, g√©n√©rateur etc.</span></h1>
                        <p class="highlight"><span>Cr√©er un faux serveur, des requ√™tes, des r√©ponses‚Ä¶</span></p>
                        <p class="highlight"><span class="fragment">Cr√©er un client pour int√©ragir avec l'API‚Ä¶</span></p>
                        <p class="highlight"><span class="fragment">G√©n√©rer de fausses donn√©es en utilisant le sch√©ma‚Ä¶</span></p>
                        <aside class="notes">
                            On a commenc√© √† s'int√©resser √† cet √©cosyst√®me, comment s'assurer que notre documentation n'est pas obsol√®te, ne contient pas d'erreur.
                            <br>
                            La majeur partie des outils que nous avons trouv√©, que ce soit en PHP, en Python, en JavaScript ou dans d'autres langages permettent √† partir d'une documentation de faciliter l'int√©raction avec le serveur distant. La construction automatique de requ√™tes, de r√©ponses‚Ä¶
                            <br>
                            ‚ñ∂ On a aussi des g√©n√©rateurs de client comme Jane qui a √©t√© cr√©√© par des d√©veloppeurs de chez Jolicode.
                            <br>
                            Tout √ßa c'est bien mais √ßa ne collait pas exactement avec ce qu'on cherchait. L'API que nous d√©veloppons est principalement utilis√©e par le front du projet comme je l'expliquais tout √† l'heure.
                            <br>
                            ‚ñ∂ Nous connaissons pr√©cisement les requ√™tes, les r√©sultats attendus, on peut cr√©er des fixtures pour avoir tout les cas utiles.
                            <br>
                            On a continuer de chercher pour finalement tomber sur une librairie de validation.
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>‚úÖ Validation</span></h1>
                        <img class="absolute plain" src="img/phpleague.png" width="250" style="right: 0; left: auto; top: -5%"/>
                        <p class="highlight"><code>league/openapi-psr7-validator</code></p>
                        <p><img class="plain" src="img/psr7-validator.jpg" /></p>
                        <aside class="notes">
                            Cette librairie fait partie de la ligue des packages extraordinaires.
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>‚úÖ Validation</span></h1>
                        <img class="absolute plain" src="img/phpleague.png" width="250" style="right: 0; left: auto; top: -5%"/>
                        <p class="highlight"><span><strong>‚ù§Ô∏è PSRs HTTP</strong>: Message, Client, Factories‚Ä¶</span></p>
                        <p class="highlight"><span class="fragment">‚Ä¶ con√ßu comme un middleware ‚Ä¶</span></p>
                        <p class="highlight"><span class="fragment">‚Ä¶ framework agnostic ‚Ä¶</span></p>
                        <p class="highlight"><span class="fragment">‚Ä¶ bas√© sur des outils fiables et maintenus.</span></p>
                        <aside class="notes">
                        </aside>
                    </section>
                </section>
                <section>
                    <section class="invert" data-background-image="img/magnifying-glass.jpg">
                        <h1 class="left highlight white"><span>üîå Impl√©mentation</span></h1>
                        <aside class="notes">
                            Nous ne sommes pas uniquement des grands malades de la documentation √©crite en YAML. Nous utilisons les outils de l'√©cosyst√®me de Symfony.
                            <br>
                            Cependant ce qui va √™tre pr√©sent√© ensuite pourra tout √† fait √™tre adapt√© √† d'autres types de projet.
                            <br>
                            Commen√ßons par voir l'objectif g√©n√©ral et ensuite on va voir comment on a impl√©menter chaque brique.
                            <!--
                                Une documentation technique, automatisation possible

                                V√©rifier que les requ√™tes et r√©ponses sont correctement d√©crites

                                V√©rifier que l'API r√©pond correctement aux attentes

                                Sp√©cification des appels

                                Raven
                            -->
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>üí° Id√©e g√©n√©rale</span></h1>
                        <img class="plain" src="img/schema.svg" />
                        <aside class="notes">
                            J'ai essay√© de reprendre les points importants qui nous int√©ressent ici.
                            <br>
                            Le validateur peut v√©rifier la requ√™te et la r√©ponse, on pourra r√©cup√©rer les erreurs g√©n√©r√©es et les ressortir pour correction. Mais √ßa ne suffit pas.
                            <br>
                            Il faut pouvoir c√¢bler tout √ßa: construire des requ√™tes, les envoyer dans un client HTTP, r√©cup√©rer la r√©ponse.
                            <br>
                            Pour tout ces aspects nous avons bien sur choisit de nous appuyer sur les diff√©rentes PSR disponibles.
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>HTTP <small>PHP Standard Recommandation</small></span></h1>
                        <p class="highlight"><span><strong><code>&nbsp;7</code>. Message:</strong> <code style="font-size: 1.7rem;">{<strong>Request,Response,ServerRequest</strong>}Interface</code></span></p>
                        <p class="highlight"><span class="fragment"><strong><code>17</code>. Factories:</strong> <code style="font-size: 1.7rem;">{<strong>Request,Uri,Stream</strong>}FactoryInterface</code></span></p>
                        <p class="highlight"><span class="fragment"><strong><code>18</code>. Client:</strong> <code style="font-size: 1.7rem;"><strong>Client</strong>Interface</code></span></p>
                        <aside class="notes">
                            √áa fait plusieurs fois que je mentionne PSR. Ce sont des recommandations port√©es par la communaut√© au sein du PHP Fig.
                            <br>
                            On est dans l'univers HTTP, on va s'int√©resser principalement √† trois d'entre elles.
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>HttpFoundation ‚ù§Ô∏è PSR</span></h1>
                        <p class="highlight"><code>symfony/psr-http-message-bridge</code></p>
                        <pre style="font-size: 1.25rem">
                            <code class="php">use Symfony\Bridge\PsrHttpMessage\Factory\HttpFoundationFactory;
use Symfony\Bridge\PsrHttpMessage\Factory\PsrHttpFactory;

$symfonyRequest = $httpFoundationFactory->createRequest($psrServerRequest);

$psrResponse = $psrHttpFactory->createResponse($symfonyResponse);
</code>
                        </pre>
                        <aside class="notes">
                            Par d√©faut, Symfony n'utilise pas le format de message HTTP de la PSR7. Il faut donc transformer la requ√™te Symfony en requ√™te PSR puis la r√©ponse PSR en r√©ponse Symfony.
                            <br>
                            Heureusement l'√©cosyst√®me de PHP est riche et il existe un package pour nous aider.
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>HttpKernel ‚ù§Ô∏è PSR</span></h1>
                        <pre class="absolute top120" style="font-size: 1.2rem">
                            <code class="php" data-line-numbers="">use Psr\Http\Client\ClientInterface;
use Psr\Http\Message\{RequestInterface,ResponseInterface};

class HttpKernelClient implements ClientInterface
{
    /* constructor */

    public function sendRequest(RequestInterface $request): ResponseInterface
    {
        /* transform RequestInterface to ServerRequestInterface */

        $response = $this->kernel->handle(
            $this->httpFoundationFactory->createRequest($serverRequest)
        );
        return $this->psrHttpFactory->createResponse($response);
    }
}
</code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.2rem">
                            <code class="php" data-line-numbers="1,4">use Psr\Http\Client\ClientInterface;
use Psr\Http\Message\{RequestInterface,ResponseInterface};

class HttpKernelClient implements ClientInterface
{
    /* constructor */

    public function sendRequest(RequestInterface $request): ResponseInterface
    {
        /* transform RequestInterface to ServerRequestInterface */

        $response = $this->kernel->handle(
            $this->httpFoundationFactory->createRequest($serverRequest)
        );
        return $this->psrHttpFactory->createResponse($response);
    }
}
</code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.2rem">
                            <code class="php" data-line-numbers="12-15">use Psr\Http\Client\ClientInterface;
use Psr\Http\Message\{RequestInterface,ResponseInterface};

class HttpKernelClient implements ClientInterface
{
    /* constructor */

    public function sendRequest(RequestInterface $request): ResponseInterface
    {
        /* transform RequestInterface to ServerRequestInterface */

        $response = $this->kernel->handle(
            $this->httpFoundationFactory->createRequest($serverRequest)
        );
        return $this->psrHttpFactory->createResponse($response);
    }
}
</code>
                        </pre>
                        <aside class="notes">

                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>üîß Int√©gration validation</span></h1>
                        <pre class="absolute top120" style="font-size: 1.35rem">
                            <code class="php" data-line-numbers>use League\OpenAPIValidation\PSR7;

/* Load OpenAPI doc */
$builder = (new PSR7\ValidatorBuilder)->fromYamlFile($yamlFile);

$builder->getRequestValidator()->validate($request);

/* Trigger request and get response */

$operation = new PSR7\OperationAddress('/api/users/me', 'get') ;
$builder->getResponseValidator()->validate($operation, $response);
</code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.35rem">
                            <code class="php" data-line-numbers="4">use League\OpenAPIValidation\PSR7;

/* Load OpenAPI doc */
$builder = (new PSR7\ValidatorBuilder)->fromYamlFile($yamlFile);

$builder->getRequestValidator()->validate($request);

/* Trigger request and get response */

$operation = new PSR7\OperationAddress('/api/users/me', 'get') ;
$builder->getResponseValidator()->validate($operation, $response);
</code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.35rem">
                            <code class="php" data-line-numbers="6">use League\OpenAPIValidation\PSR7;

/* Load OpenAPI doc */
$builder = (new PSR7\ValidatorBuilder)->fromYamlFile($yamlFile);

$builder->getRequestValidator()->validate($request);

/* Trigger request and get response */

$operation = new PSR7\OperationAddress('/api/users/me', 'get') ;
$builder->getResponseValidator()->validate($operation, $response);
</code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.35rem">
                            <code class="php" data-line-numbers="10,11">use League\OpenAPIValidation\PSR7;

/* Load OpenAPI doc */
$builder = (new PSR7\ValidatorBuilder)->fromYamlFile($yamlFile);

$builder->getRequestValidator()->validate($request);

/* Trigger request and get response */

$operation = new PSR7\OperationAddress('/api/users/me', 'get') ;
$builder->getResponseValidator()->validate($operation, $response);
</code>
                        </pre>
                        <aside class="notes">
                            Maintenant on est capable d'envoyer des requ√™tes vers notre application et de r√©cup√©rer des r√©ponses.
                            <br>
                            Nous souhaitons automatiser les tests et cette partie permet de facilement s'int√©grer dans un outil comme PHPUnit.
                            <br>
                            C'est aussi possible de directement faire des vraies requ√™tes √† travers le r√©seau. Dans ce cas le client HTTP que vous allez utilisez sera diff√©rent.
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>üí° Id√©e g√©n√©rale</span></h1>
                        <img class="plain" src="img/schema.svg" />
                        <p class="highlight"><span class="fragment">On veut des tests m√©tiers !</span></p>
                        <aside class="notes">
                            Si on s'arr√™te la, on est capable de valider nos requ√™tes et nos r√©ponses. Mais le fait que ces r√©qu√™tes et r√©ponses soient valide n'est pas toujours le r√©sultat attendu.
                            <br>
                            Dans la documentation OpenAPI on d√©crit tout les cas possibles. Si mon URL me renvoit une 403, c'est un cas qui est acceptable mais est-ce que c'est le r√©sultat attendu. L'API, quand elle est d√©velopp√©e doit r√©pondre √† des contraintes. Il faut aller plus loin que la validation stricte. On veut pouvoir s'assurer que le r√©sultat est bien celui attendu.
                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span><code>chstudio/raven</code></span></h1>
                        <img class="absolute plain" src="img/github.png" width="120" style="right: 0; left: auto; top: -5%"/>
                        <p class="highlight"><span class="fragment"><code>1.</code> Validation par rapport √† la documentation</span></p>
                        <p class="highlight"><span class="fragment"><code>2.</code> Utilisation de vraies donn√©es pour tester</span></p>
                        <p class="highlight"><span class="fragment"><code>3.</code> V√©rification du comportement de l'API</span></p>
                        <aside class="notes">

                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>Construire les requ√™tes ?</span></h1>
                        <p class="highlight"><span class="fragment">S'appuie sur <code>fakerphp/faker</code>‚Ä¶</span></p>
                        <p class="highlight"><span class="fragment">‚Ä¶ r√©solution de donn√©es dynamique ‚Ä¶</span></p>
                        <p class="highlight"><span class="fragment">‚Ä¶ ajout des contraintes de validation.</span></p>
                        <aside class="notes">

                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>RequestFactory ‚ù§Ô∏è PSR</span></h1>
                        <pre class="absolute top120" style="font-size: 1.3rem">
                            <code class="php" data-line-numbers>$request = $requestFactory->fromArray([
    'uri' => [
        'base' => '/api/users/{id}',
        'parameters' => [
            '{id}' => '&lt;userId()&gt;'
        ]
    ],
    'method' => 'POST',
    'body' => [
        'name' => '&lt;name()&gt;',
        'creationDate' => '&lt;date("Y-m-d")&gt;',
        'office' => '&lt;officeId("LYON")&gt;'
    ]
]);
</code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.3rem">
                            <code class="php" data-line-numbers="3,5,10-12">$request = $requestFactory->fromArray([
    'uri' => [
        'base' => '/api/users/{id}',
        'parameters' => [
            '{id}' => '&lt;userId()&gt;'
        ]
    ],
    'method' => 'POST',
    'body' => [
        'name' => '&lt;name()&gt;',
        'creationDate' => '&lt;date("Y-m-d")&gt;',
        'office' => '&lt;officeId("LYON")&gt;'
    ]
]);
</code>
                        </pre>
                        <aside class="notes">

                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>Expectations</span></h1>
                        <pre class="absolute top120" style="font-size: 1.3rem">
                            <code class="php" data-line-numbers>use CHStudio\Raven\Validator\Expectation\ExpectationFactory;

$requestData = [
    'uri' => 'http://myhost.com/api/users/me',
    'method' => 'GET',
    'statusCode' => 403
];

$expectations = (new ExpectationFactory())->fromArray($requestData);
$request = $requestFactory->fromArray($requestData);

$executor->execute($request, $expectations);
</code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.3rem">
                            <code class="php" data-line-numbers="6,9,12">use CHStudio\Raven\Validator\Expectation\ExpectationFactory;

$requestData = [
    'uri' => 'http://myhost.com/api/users/me',
    'method' => 'GET',
    'statusCode' => 403
];

$expectations = (new ExpectationFactory())->fromArray($requestData);
$request = $requestFactory->fromArray($requestData);

$executor->execute($request, $expectations);
</code>
                        </pre>
                        <aside class="notes">

                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>Raven ‚ù§Ô∏è PHPUnit</span></h1>
                        <pre class="absolute top120" style="font-size: 1.2rem">
                            <code class="php" data-line-numbers>use Symfony\Bundle\FrameworkBundle\Test\WebTestCase;

class OpenApiTest extends WebTestCase
{
    /** @dataProvider giveRequests */
    public function testThroughOpenApi(array $requestData)
    {
        $httpClient = new HttpKernelClient(self::createKernel());

        /** [...] */
    }

    public function giveRequests(): Generator
    {
        yield /** [...] */
    }
}
</code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.2rem">
                            <code class="php" data-line-numbers>$factory = Factory::fromYamlFile('doc/api/openapi.yaml');
$executor = new Executor(
    $httpClient,
    $factory->getRequestValidator(),
    $factory->getResponseValidator()
);

$request = $requestFactory->fromArray($requestData);
$expectations = $expectationFactory->fromArray($requestData);

try {
    $executor->execute($request, $expectations);
} catch (Throwable $e) {
    $message = $e->getMessage();
}

static::assertNull($message, $message ?? '');
</code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.2rem">
                            <code class="php" data-line-numbers="1">$factory = Factory::fromYamlFile('doc/api/openapi.yaml');
$executor = new Executor(
    $httpClient,
    $factory->getRequestValidator(),
    $factory->getResponseValidator()
);

$request = $requestFactory->fromArray($requestData);
$expectations = $expectationFactory->fromArray($requestData);

try {
    $executor->execute($request, $expectations);
} catch (Throwable $e) {
    $message = $e->getMessage();
}

static::assertNull($message, $message ?? '');
</code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.2rem">
                            <code class="php" data-line-numbers="2-6">$factory = Factory::fromYamlFile('doc/api/openapi.yaml');
$executor = new Executor(
    $httpClient,
    $factory->getRequestValidator(),
    $factory->getResponseValidator()
);

$request = $requestFactory->fromArray($requestData);
$expectations = $expectationFactory->fromArray($requestData);

try {
    $executor->execute($request, $expectations);
} catch (Throwable $e) {
    $message = $e->getMessage();
}

static::assertNull($message, $message ?? '');
</code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.2rem">
                            <code class="php" data-line-numbers="8-15">$factory = Factory::fromYamlFile('doc/api/openapi.yaml');
$executor = new Executor(
    $httpClient,
    $factory->getRequestValidator(),
    $factory->getResponseValidator()
);

$request = $requestFactory->fromArray($requestData);
$expectations = $expectationFactory->fromArray($requestData);

try {
    $executor->execute($request, $expectations);
} catch (Throwable $e) {
    $message = $e->getMessage();
}

static::assertNull($message, $message ?? '');
</code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.2rem">
                            <code class="php" data-line-numbers="17">$factory = Factory::fromYamlFile('doc/api/openapi.yaml');
$executor = new Executor(
    $httpClient,
    $factory->getRequestValidator(),
    $factory->getResponseValidator()
);

$request = $requestFactory->fromArray($requestData);
$expectations = $expectationFactory->fromArray($requestData);

try {
    $executor->execute($request, $expectations);
} catch (Throwable $e) {
    $message = $e->getMessage();
}

static::assertNull($message, $message ?? '');
</code>
                        </pre>
                        <aside class="notes">

                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>Raven ‚ù§Ô∏è PHPUnit</span></h1>
                        <pre class="absolute top120" style="font-size: 1.3rem">
                            <code class="php" data-line-numbers="">/** Exemple d'erreur de validation dans PHPUnit */

‚úò Through open api with users.yaml::/api/users/me
‚îê
‚îú Unexpected status code 500, expected 200
‚îú Failed asserting that false is true.
‚îÇ
‚ïµ /app/tests/Api/OpenApiTest.php:94
‚î¥
                             </code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.3rem">
                            <code class="php" data-line-numbers="5">/** Exemple d'erreur de validation dans PHPUnit */

‚úò Through open api with users.yaml::/api/users/me
‚îê
‚îú Unexpected status code 500, expected 200
‚îú Failed asserting that false is true.
‚îÇ
‚ïµ /app/tests/Api/OpenApiTest.php:94
‚î¥
                             </code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.3rem">
                            <code class="php" data-line-numbers="">/** Exemple d'erreur de validation dans PHPUnit */

‚úò Through open api with users.yaml::/api/users/me
‚îê
‚îú Data validation failed for property data.attributes.email,
‚îú invalid value: array (
‚îú   'name' => 'Jane Doe',
‚îú   'updatedAt' => '2022-10-14'
‚îú )
‚îú Keyword validation failed: Required property 'email' must
‚îú be present in the object.
‚îú
‚îú Failed asserting that false is true.
‚îÇ
‚ïµ /app/tests/Api/OpenApiTest.php:94
‚î¥
</code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.3rem">
                            <code class="php" data-line-numbers="5-9">/** Exemple d'erreur de validation dans PHPUnit */

‚úò Through open api with users.yaml::/api/users/me
‚îê
‚îú Data validation failed for property data.attributes.email,
‚îú invalid value: array (
‚îú   'name' => 'Jane Doe',
‚îú   'updatedAt' => '2022-10-14'
‚îú )
‚îú Keyword validation failed: Required property 'email' must
‚îú be present in the object.
‚îú
‚îú Failed asserting that false is true.
‚îÇ
‚ïµ /app/tests/Api/OpenApiTest.php:94
‚î¥
</code>
                        </pre>
                        <pre class="absolute top120 fragment fade-in" style="font-size: 1.3rem">
                            <code class="php" data-line-numbers="10-11">/** Exemple d'erreur de validation dans PHPUnit */

‚úò Through open api with users.yaml::/api/users/me
‚îê
‚îú Data validation failed for property data.attributes.email,
‚îú invalid value: array (
‚îú   'name' => 'Jane Doe',
‚îú   'updatedAt' => '2022-10-14'
‚îú )
‚îú Keyword validation failed: Required property 'email' must
‚îú be present in the object.
‚îú
‚îú Failed asserting that false is true.
‚îÇ
‚ïµ /app/tests/Api/OpenApiTest.php:94
‚î¥
</code>
                        </pre>
                        <aside class="notes">

                        </aside>
                    </section>
                    <section class="left invert">
                        <h1 class="highlight"><span>ü§© Doc test√©e et valid√©e !</span></h1>
                        <p class="highlight"><span class="fragment">Respect du sch√©ma ‚Ä¶</span></p>
                        <p class="highlight"><span class="fragment">‚Ä¶ requ√™tes bas√© sur des vraies donn√©es ‚Ä¶</span></p>
                        <p class="highlight"><span class="fragment">‚Ä¶ v√©rifications sp√©cifiques au projet.</span></p>
                        <aside class="notes">

                        </aside>
                    </section>
                </section>
                <section class="stack">
                    <section data-background-image="img/thinking.jpg" data-background-color="rgba(255, 255, 255, 1)">
                        <h1 class="left bottom highlight"><span>Et maintenant ?</span></h1>
                        <aside class="notes">

                        </aside>
                    </section>
                    <section class="invert left">
                        <h1 class="highlight"><span>Pourquoi ne pas essayer ?</span></h1>
                        <p class="highlight"><span class="fragment">Un projet GitHub avec un <code>README</code>,</span></p>
                        <p class="highlight"><span class="fragment">Une utilisation des standards,</span></p>
                        <p class="highlight"><span class="fragment">Contributions bienvenues üòú.</span></p>
                        <aside class="notes">
                            <!--
                                However it's an open project so you can already explore the code and give it a try. I'll share with you a really small repository to show you how it can be used.
                                <br/>
                                It doesn't handle all the cases but since it's under active development you can submit issues and try working with the authors to improve if you want. The more project will use it, the more powerful it will be !
                            -->
                        </aside>
                    </section>
                    <section class="invert left">
                        <h1 class="highlight"><span>Comment d√©marrer ?</span></h1>
                        <p class="highlight"><span>Tout ne doit pas √™tre document√© ‚Ä¶</span></p>
                        <p class="highlight"><span class="fragment">‚Ä¶ un point d'API √† la fois ‚Ä¶</span></p>
                        <p class="highlight"><span class="fragment">‚Ä¶ enrichir les tests avec les cas particuliers.</span></p>
                        <aside class="notes">
                            <!--
                                Maybe this presentation make you think that validating data is complex. You may just think about how you actually validate your inputs. By using a proper validation solution, you can limit the number of problems your code will encounter and that's a very good reason to try different tools !
                                <br/>
                                Also, if you're already familiar with other validation tools, don't throw them away, every software and library have its strengths and weaknesses. Just try to be informed on what the community is working on !
                            -->
                        </aside>
                    </section>
                    <section class="invert left">
                        <h1 class="highlight"><span>üßå Pr√©parez vous au DDD</span></h1>
                        <p class="highlight"><span class="fragment">‚ñ∂  <strong>D</strong>ocumentation <strong>D</strong>riven <strong>D</strong>esign</span></p>
                        <p class="highlight"><span class="fragment">Documenter l'API, √©crire les requ√™tes ‚Ä¶</span><span class="fragment">‚Ä¶ puis coder !</span></p>
                        <aside class="notes">
                            <!--
                                And I'll finish on this one, which is the most important for me. You always need to keep an eye on cutting edge tools and technologies. Try to read articles, wrote some tests around a new tool you discovered‚Ä¶ The more you'll see, the best your solutions will be.
                                <br/>
                                Don't forget that most of us are software developers and engineers, our job is to find solutions not to generate problems. Our role is to find the correct tools depending the context.
                            -->
                        </aside>
                    </section>
                </section>
<!--#########################################################################-->
                <section class="invert" data-background-image="../assets/images/thank-you.jpg">
                    <img src="img/qr.png" class="plain" style="position:absolute; right:0; top:0;" width="250" />
                    <p class="highlight right bottom">
                        <span><i class="fa fa-twitter"></i> @s_hulard</span><br/><br/>
                        <span><i class="fa fa-github"></i> https://github.com/chstudio/raven</span><br/>
                    </p>
                    <aside class="notes">
                        <!--
                            I added here two important links. The Valinor repository and my sample repository which I presented you in the slides.
                            <br/>
                            This QRCode will send you the my project, in the README, you'll also have the link to Valinor.
                            <br/>
                            Thank for your attention‚Ä¶ Feel free to ask any question !
                        -->
                    </aside>
                </section>
            </div>
        </div>

        <script src="../assets/reveal.js/js/reveal.js"></script>
        <script src="../assets/javascripts/mermaid.min.js"></script>

        <script>
            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: false,
                progress: true,
                history: true,
                center: true,
                pdfSeparateFragments: false,
                //showNotes: 'separated-page',

                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
                transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: '../assets/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: '../assets/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: '../assets/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: '../assets/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: '../assets/reveal.js/plugin/zoom-js/zoom.js', async: true },
                    { src: '../assets/reveal.js/plugin/notes/notes.js', async: true }
                ]
            });

            mermaid.initialize({startOnLoad:true});
        </script>
    </body>
</html>
