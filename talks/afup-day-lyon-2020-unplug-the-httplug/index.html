<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>Unplug the HTTPlug‚Ä¶ - AFUP Day Lyon 2020 - St√©phane HULARD / CHStudio</title>

        <meta name="description" content="HTTPlug est un petit √©cosyst√®me (librairies, adapteurs, bridges avec les frameworks, actif dans la cr√©ation des PSRs‚Ä¶) qui peut aider √† cr√©er une abstraction autour du client HTTP. Il contient les adapteurs vers les librairies les plus connues (Guzzle, cURL, ‚Ä¶) et adopte compl√®tement les PSR7 et PSR18. En utilisant quelque chose comme HTTPlug, vous aurez la possibilit√© de normaliser le comportement et d'avoir un seul point d'entr√©e pour interagir avec les APIs.">
        <meta name="author" content="St√©phane HULARD">

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

        <link rel="stylesheet" href="../assets/reveal.js/css/reveal.css">
        <link rel="stylesheet" href="../assets/css/font-awesome.min.css">
        <link rel="stylesheet" href="../assets/css/theme.css" id="theme">

        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="../assets/css/tomorrow.css">

        <style type="text/css">
            .reveal .social-me {
                float: right;
            }
            .reveal .social-me img {
                margin-bottom: 0px;
            }
            .reveal .social-me a {
                color: #FFF;
                margin-right: 10px;
            }
            .reveal .social-me a:hover {
                color: rgba(4, 32, 41, 0.9);
            }
            .reveal .social-me a:last-child {
                margin-right: 0;
            }
            .right {
                text-align: right;
            }
            .bottom {
                margin-top: 35% !important;
            }
            .top {
                margin-bottom: 35% !important;
            }
            .left {
                text-align: left;
            }
            .float-right {
                float: right;
            }
            .background {
                background-color: rgba(255, 255, 255, 0.9) !important;
            }
            .no-background {
                background: none !important;
            }
            .border-radius {
                border-radius: 20px;
            }
            code.fragment {
                padding: 12px;
            }
            .full-height {
                max-height: unset !important;
            }
            .reveal {
                background-color: rgba(0, 174, 239, 0.8);
            }
            .reveal h1.highlight *, .reveal p.highlight>* {
                background-color: rgba(4, 32, 41, 0.9);
                display: inline;
                padding-left: 15px;
                padding-right: 15px;
            }
            .reveal h1.highlight *:last-child {
                line-height: 2em
            }
            .reveal section>p {
                font-size: 1.2em;
            }
            .reveal section>a>img.plain {
                margin: 23px 0;
                height: 94px;
            }
            .reveal section>a+a>img.plain {
                margin-right: 10px;
            }
            .reveal section.invert {
                color: rgba(0, 0, 0, 0.8);
            }
            .reveal pre {
                font-size: 1.3rem;
            }
            .reveal pre code {
                padding: 5px 1.5rem;
            }

            .reveal section.invert p.highlight>* {
                background-color: rgba(255, 255, 255, 0.9)
            }
            .speaker-controls-notes .value {
                font-size: 1em !important;
            }

            .reveal .slide-background.present {
                opacity: 0.9;
            }

            .light-background .reveal .slide-background.present {
                opacity: 0.6;
            }

            .relative {
                position: relative;
            }
            .absolute {
                position: absolute !important;
                top: 70%;
                left: 0;
            }

            @media print {
                .fragment.absolute {
                    display: none;
                }
            }

            .reveal .slide-background-content {
                opacity: 0.8;
            }
        </style>

        <!-- Printing and PDF exports -->
        <script>
            var link = document.createElement( 'link' );
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match( /print-pdf/gi ) ? '../assets/reveal.js/css/print/pdf.css' : '../assets/reveal.js/css/print/paper.css';
            document.getElementsByTagName( 'head' )[0].appendChild( link );
        </script>

        <!--[if lt IE 9]>
        <script src="../assets/reveal.js/lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="reveal concave center">
            <div class="slides">
                <section data-background-image="img/unplug.jpg">
                    <h1 class="highlight top" style="font-size: 3em;"><span>Unplug the HTTPlug</span></h1>
                    <p class="global-footer">
                        <a href="https://chstudio.fr"><img src="../../logo.png" width="20" class="plain" /></a>
                        <a href="https://afup.org"><img src="img/afup.png" width="20" class="plain" /></a>
                        <span><time datetime="2020-06-24">2020</time>&nbsp;-&nbsp;AFUP Day Lyon</span>
                    </p>
                    <aside class="notes">
                        Bonjour √† tous !
                    </aside>
                </section>
                <section class="invert">
                    <p class="social-me">
                        <img src="img/moi.jpg" class="plain" width="225"/>
                        <br/>
                        <a class="white" target="_blank" href="https://twitter.com/s_hulard">@s_hulard</a>
                        <br/>
                        <a class="white" target="_blank" href="https://chstudio.fr"><i class="fa fa-globe"></i></a>
                        <a class="white" target="_blank" href="https://www.linkedin.com/in/shulard"><i class="fa fa-linkedin"></i></a>
                        <a class="white" target="_blank" href="https://github.com/shulard"><i class="fa fa-github"></i></a>
                        <a class="white" target="_blank" href="https://gitlab.com/shulard"><i class="fa fa-gitlab"></i></a>
                    </p>
                    <h1 class="highlight left"><span>St√©phane Hulard</span></h1>
                    <p class="left highlight">
                        <span class="fragment">Consultant, </span>
                        <span class="fragment">Formateur, </span>
                        <span class="fragment">Contributeur.</span>
                    </p>
                    <aside class="notes">
                        Je commence par me pr√©senter, ‚ñ∂ consultant ind√©pendant. J'aime beaucoup travailler sur des projets legacy pour accompagner les √©quipes √† les reprendre en main.
                        <br/>
                        ‚ñ∂ Je suis aussi formateur principalement autour des outils et m√©thodes li√©s √† la qualit√© logicielle.
                        <br/>
                        ‚ñ∂ Et enfin contributeur, pas autant que je le voudrais mais les projets open sources me permettent d'√©largir ma vision du m√©tier en b√©n√©ficiant de l‚Äôexpertise et du soutien de la communaut√©.
                    </aside>
                </section>
                <section>
                    <section class="invert" data-background-image="img/elephant.jpg">
                        <img src="img/httplug.png" class="plain float-right" width="250" />
                        <h1 class="highlight left"><span>HTTPlug ?</span></h1>
                        <p class="highlight left">
                            <span class="fragment">Un √©l√©phant qui parle HTTP !</span>
                        </p>
                        <aside class="notes">
                            Rentrons dans le vif du sujet, HTTPlug est un ensemble
                            de librairie qui permet de g√©rer les appels HTTP dans
                            vos applications.<br/>
                            ‚ñ∂ Tr√®s impliqu√©s dans les PSR, les mainteneurs essaient
                            de structurer cette partie de plus en plus centrale
                            dans les projets.<br/>
                            J'ai d√©couvert ces outils il y a quelques ann√©es et
                            j'avais m√™me contribu√© au d√©veloppement de l'adapteur
                            ReactPHP. Je reviendrai dessus un peu plus tard.<br/>
                            Aujourd'hui, je ne d√©marre pas un projet sans utiliser
                            HTTPlug et c'est m√™me un crit√®re de choix dans les
                            d√©pendances que je vais installer.
                        </aside>
                    </section>
                    <section class="invert left" data-background-image="img/swiss-knife-mess.jpg" data-state="light-background">
                        <h1 class="highlight"><span>Pourquoi ?</span></h1>
                        <p class="highlight">
                            <span class="fragment">Centraliser les appels HTTP de plus en plus pr√©sents.</span><br/>
                            <span class="fragment">Faciliter les tests et le debug.</span>
                        </p>
                        <aside class="notes">
                            HTTPlug permet d'√©crire des librairies et applications
                            n√©cessitant un client HTTP sans pour autant les lier
                            √† une impl√©mentation sp√©cifique.<br/>
                            ‚ñ∂ Un client, c'est quoi ? Finalement c'est un objet √† qui
                            on peut donner une `Request` et obtenir une `Response`.<br/>
                            Si tout les packages dans une application utilisent
                            HTTPlug, les d√©veloppeurs peuvent choisir une implementation
                            qui sera partag√©e par tout le code.<br/>
                            ‚ñ∂ On centralise ainsi tout les appels ce qui permettra d'aider
                            √† g√©rer les logs ou contr√¥ler le comportement autour.<br/>
                            √áa facilite aussi le debug et les tests parce qu'on
                            sait toujours o√π regarder quand on a un soucis autour
                            de ces appels.<br/>
                            Enfin, on ne s'int√©resse pas directement au fait que
                            le client soit capable de r√©ellement faire un appel
                            r√©seau mais simplement qu'il existe.
                        </aside>
                    </section>
                    <section class="invert left" data-background-image="img/story.jpg" data-state="light-background">
                        <h1 class="highlight"><span>üê£ L'arriv√©e d'HTTPlug</span></h1>
                        <p class="highlight">
                            <span class="fragment"><b>Avril 2015</b> - Premier commit</span><br/>
                            <span class="fragment"><b>Octobre 2018</b> - Version 2.0, compatible PSR18</span><br/>
                            <span class="fragment"><b>Novembre 2018</b> - Sortie de la PSR18</span><br/>
                            <span class="fragment"><b>2020</b> - Int√©gration de plus en plus r√©pandue</span>
                        </p>
                        <aside class="notes">
                            ‚ñ∂ Avant HTTPlug, il y avait d√©j√† des outils pour faciliter
                            l'utilisation des diff√©rents clients du march√©. L'arriv√©e
                            des PSR a permis de faire √©merger cette nouvelle solution.<br/>
                            ‚ñ∂ HTTPlug, est un √©cosyst√®me et ne vient pas comme une
                            brique compl√®te √† installer, on choisit seulement les
                            morceaux utiles et on limite les d√©pendances.<br/>
                            ‚ñ∂ Les mainteneurs ont port√© la PSR18 li√©e au client HTTP,
                            et ont men√© au bout cette recommendation qui est sortie
                            en 2018.<br/>
                            ‚ñ∂ Comme la compatibilit√© √©tait au rendez-vous d√®s la
                            validation, HTTPlug c'est pour moi impos√© comme une
                            r√©f√©rence. Aujourd'hui, de plus en plus de
                            librairie utilisent ces interfaces et on commence √†
                            d√©coupler de plus en plus ces probl√©matiques.
                        </aside>
                    </section>
                    <section class="invert left" data-background-image="img/build.jpg">
                        <h1 class="highlight"><span>Un √©cosyst√®me complet</span></h1>
                        <p class="highlight"><span><b>Clients:</b> cURL, socket.</span></p>
                        <p class="highlight"><span><b>Adapteurs:</b> Guzzle(5/6), Symfony&nbsp;HTTPClient, ReactPHP‚Ä¶</span></p>
                        <p class="highlight"><span><b>Plugins:</b> Authentification, Log, Cache‚Ä¶</span></p>
                        <pre style="font-size: 2rem;" class="fragment">
                            <code class="bash">composer require php-http/[client,plugin]</code>
                        </pre>
                        <aside class="notes">
                            L'√©ventail de solution propos√©e est large et permet donc
                            de s'adapter aux habitudes de chaque √©quipe. C'est pour
                            moi une des forces parce que si vous √™tes habitu√© √†
                            utilis√© cURL, vous pouvez continuer de le faire, pareil
                            si vous pr√©f√©rez Guzzle ou autre.<br/>
                            Finalement c'est un ensemble d'interfaces et d'impl√©mentations
                            qui sont interchengeables en fonction des besoins.<br/>
                            Malgr√© tout, chaque impl√©mentation est sp√©cifique.
                            Par exemple, le client HTTP de Symfony g√©rait le
                            HTTP2 √† sa sortie ce qui n'√©tait pas le cas de tout les autres.<br/>
                            ‚ñ∂ Si vous avez des besoins pr√©cis, il suffit juste de remplacer
                            l'impl√©mentation avec le bon paquet composer et voila.<br/>
                            Le code de l'application ne changera pas et vos tests
                            continueront de fonctionner !
                        </aside>
                    </section>
                </section>
                <section>
                    <section class="invert" data-background-image="img/bored.jpg">
                        <h1 class="highlight left top"><span>Encore un nouvel outil ?</span></h1>
                        <p class="highlight right bottom"><span class="fragment">Pourquoi faire simple‚Ä¶</p>
                        <aside class="notes">
                            C'est bien beau mais √ßa semble quand m√™me compliqu√©. <br/>
                            ‚ñ∂ On sait d√©j√† faire des appels HTTP, on a d√©j√† nos petites
                            habitudes. Parfois, en mode simpliste, on passe m√™me par des simple
                            <code>file_get_contents</code> alors pourquoi rajouter
                            une abstraction dans notre code ?
                        </aside>
                    </section>
                    <section class="invert left" data-background-image="img/door.jpg">
                        <h1 class="highlight bottom"><span>Prendre du recul</span></h1>
                        <p class="highlight"><span class="fragment">Interop√©rabilit√© ?</span></p>
                        <aside class="notes">
                            D√©pendre d'une impl√©mentation va demander
                            aux d√©veloppeurs de maintenir et faire √©voluer le code
                            applicatif avec. Par exemple, Guzzle a chang√© son namespace
                            en passant de la version 3 √† la version 4. Si vous d√©pendez
                            directement de Guzzle, il faut repasser sur votre code.<br/>
                            ‚ñ∂ Ensuite viennent les PSR, ces recommandations port√©es
                            par le PHP-FIG qui tiennent √† am√©liorer l'interop√©rabilit√©
                            entre les projets.<br/>
                            Il y a une vraie dynamique ces derni√®res ann√©es autour de
                            ces recommandations. HTTPlug s'inscrit dans cette dynamique.<br/>
                            HTTPlug ne porte donc pas sa propre vision mais plut√¥t
                            une fa√ßon d'int√©grer ces recommandations dans votre projet.<br/>
                        </aside>
                    </section>
                    <section class="invert">
                        <h1 class="highlight"><span>Utilisation des PSRs</span></h1>
                        <pre class="absolute">
                            <code class="full-height php" data-line-numbers="">use Psr\Http\Client\ClientInterface;
use Psr\Http\Message\RequestInterface;

class MyApiDataRetriever
{
    private $httpClient;

    public function __construct(ClientInterface $httpClient)
    {
        $this->httpClient = $httpClient;
    }

    public function retrieveData(RequestInterface $message): AwesomeDTO
    {
        return AwesomeDTO::fromResponse(
            $this->httpClient->sendRequest($message)
        );
    }
}
                            </code>
                        </pre>
                        <pre class="fragment absolute fade-in">
                            <code class="full-height php" data-line-numbers="1,8-11">use Psr\Http\Client\ClientInterface;
use Psr\Http\Message\RequestInterface;

class MyApiDataRetriever
{
    private $httpClient;

    public function __construct(ClientInterface $httpClient)
    {
        $this->httpClient = $httpClient;
    }

    public function retrieveData(RequestInterface $message): AwesomeDTO
    {
        return AwesomeDTO::fromResponse(
            $this->httpClient->sendRequest($message)
        );
    }
}
                            </code>
                        </pre>
                        <pre class="fragment absolute fade-in">
                            <code class="full-height php" data-line-numbers="2,13-18">use Psr\Http\Client\ClientInterface;
use Psr\Http\Message\RequestInterface;

class MyApiDataRetriever
{
    private $httpClient;

    public function __construct(ClientInterface $httpClient)
    {
        $this->httpClient = $httpClient;
    }

    public function retrieveData(RequestInterface $message): AwesomeDTO
    {
        return AwesomeDTO::fromResponse(
            $this->httpClient->sendRequest($message)
        );
    }
}
                            </code>
                        </pre>
                        <aside class="notes">
                            Je parle beaucoup des PSR, concr√®tement qu'est-ce que
                            √ßa veut dire ?<br/>
                            ‚ñ∂ La PSR18 va d√©finir ce qu'est un client HTTP donc si
                            j'ai besoin de ce type de fonctionnalit√©s, j'utilise
                            l'interface.<br/>
                            ‚ñ∂ La PSR7 d√©finit la structure des messages HTTP, Request,
                            Response et tout ce qui va avec.<br/>
                            Pour construire mon objet <code>AwesomeDTO</code> j'ai
                            besoin d'une r√©ponse PSR7. Je peux donc utiliser mon
                            client et obtenir cette r√©ponse √† partir d'une requ√™te.<br/>
                            Ici il n'est pas important de conna√Ætre les interfaces
                            ou les PSR dans le d√©tail.<br/>
                            Le code n'est pas du tout d√©pendant d'HTTPlug,
                            j'ai un objet assez simple qui d√©crit ses d√©pendances
                            et ses param√®tres.<br/>
                            HTTPlug va me permettre de fournir des impl√©mentations
                            concr√®tes pour cet objet.<br/>
                            Mon code est compl√©tement d√©coupl√© de l'impl√©mentation.
                        </aside>
                    </section>
                    <section class="invert">
                        <h1 class="highlight"><span>Impl√©mentation</span></h1>
                        <pre class="absolute">
                            <code class="full-height php" data-line-numbers="">use Http\Adapter\React\Client;
use Laminas\Diactoros\RequestFactory;

$client = new Client(/* options */);

$dto = (new MyApiDataRetriever($client))->retrieveData(
    (new RequestFactory)->createRequest('GET', 'http://example.com/api')
);
                            </code>
                        </pre>
                        <pre class="fragment absolute fade-in">
                            <code class="full-height php" data-line-numbers="1,4">use Http\Adapter\React\Client;
use Laminas\Diactoros\RequestFactory;

$client = new Client(/* options */);

$dto = (new MyApiDataRetriever($client))->retrieveData(
    (new RequestFactory)->createRequest('GET', 'http://example.com/api')
);
                            </code>
                        </pre>
                        <pre class="fragment absolute fade-in">
                            <code class="full-height php" data-line-numbers="2,7">use Http\Adapter\React\Client;
use Laminas\Diactoros\RequestFactory;

$client = new Client(/* options */);

$dto = (new MyApiDataRetriever($client))->retrieveData(
    (new RequestFactory)->createRequest('GET', 'http://example.com/api')
);
                            </code>
                        </pre>
                        <aside class="notes">
                            Voici un exemple d'implementation.<br/>
                            ‚ñ∂ J'ai choisit d'importer l'adapteur <code>React</code>
                            que je construis. Si vous utilisez un framework, cette √©tape serait r√©alis√©e dans
                            le conteneur d'injection de d√©pendances.<br/>
                            Ensuite, je construis mon objet en lui passant les bons
                            param√®tres. HTTPlug est compatible avec PSR18 donc je peux
                            directement passer mon objet.<br/>
                            ‚ñ∂ Pour construire la requ√™te √† passer, j'utiliser une factory,
                            objet qui a pour r√¥le d'initialiser ma requ√™te. C'est une
                            autre histoire, je vous invite √† voir la PSR17 pour plus de d√©tails.
                        </aside>
                    </section>
                    <section class="invert">
                        <h1 class="highlight"><span>Automatisation</span></h1>
                        <pre class="absolute">
                            <code class="full-height php" data-line-numbers="1-2,4-5">use Http\Discovery\HttpClientDiscovery;
use Http\Discovery\MessageFactoryDiscovery;

$client         = HttpClientDiscovery::find();
$messageFactory = MessageFactoryDiscovery::find();

$dto = (new MyApiDataRetriever($client))->retrieveData(
    $messageFactory->createRequest('GET', 'http://example.com/api')
);
                            </code>
                        </pre>
                        <pre class="fragment absolute fade-in">
                            <code class="full-height php" data-line-numbers="7-9">use Http\Discovery\HttpClientDiscovery;
use Http\Discovery\MessageFactoryDiscovery;

$client         = HttpClientDiscovery::find();
$messageFactory = MessageFactoryDiscovery::find();

$dto = (new MyApiDataRetriever($client))->retrieveData(
    $messageFactory->createRequest('GET', 'http://example.com/api')
);
                            </code>
                        </pre>
                        <aside class="notes">
                            Pour aller un peu plus loin, un composant sp√©cifique
                            nomm√© <code>Discovery</code> permet de faire de la
                            d√©tection de contexte automatique.<br/>
                            Bien s√ªr, aucune magie, diff√©rentes strat√©gies sont
                            utilis√©es: un simple tableau de mapping avec les
                            impl√©mentations reconnues ou des outils tiers comme
                            Puli.<br/>
                            ‚ñ∂ Cette approche permet de remonter l'abstraction d'un
                            niveau, je ne veux pas savoir quel client est install√©
                            j'en veux juste un. Si aucun n'est pr√©sent, une belle
                            exception sera lanc√©e et il suffira d'en ajouter un !<br/>
                            Le principal avantage est surtout d'√©viter d'importer
                            du code si jamais il y a d√©j√† une solution disponible.
                        </aside>
                    </section>
                    <section class="invert left" data-background-image="img/build.jpg">
                        <h1 class="highlight"><span>Une complexit√© faible</span></h1>
                        <p class="highlight">
                            <span class="fragment">S√©paration des responsabilit√©s (client, messages‚Ä¶),</span><br/>
                            <span class="fragment">D√©finition des pr√©requis pour chacun de vos objets.</span>
                        </p>
                        <aside class="notes">
                            En s'appuyant sur les recommandations de la communaut√©,
                            des interfaces sont d√©finies pour chacun des besoins.<br/>
                            ‚ñ∂ Votre code doit s'appuyer sur ces s√©parations pour limiter
                            la complexit√©. Il faut se poser quelques questions :
                            <ul>
                                <li>Mon objet doit envoyer des requ√™tes, est-ce qu'il est responsable de leur cr√©ation ?</li>
                                <li>Est-ce que mes requ√™tes ne seraient pas des objets immutables m√©tiers ?</li>
                            </ul>
                            ‚ñ∂ Souvent, la s√©paration des messages et leur traitement
                            permet d'avoir un code beaucoup plus clair et maintenable,
                            des plus petits objets, mieux ma√Ætris√©s.
                        </aside>
                    </section>
                    <section class="invert left">
                        <h1 class="highlight"><span>Adaptabilit√© et d√©corateurs</span></h1>
                        <pre class="absolute" style="font-size:1.2rem">
                            <code class="full-height php" data-line-numbers>class AwesomeDecorator implements ClientInterface
{
    private $decorated;
    public function __construct(ClientInterface $client)
    {
        $this->decorated = $client;
    }

    public function sendRequest(RequestInterface $request): ResponseInterface
    {
        /* V√©rification ou traitement sp√©cifique */
        $response = $this->decorated->sendRequest($request);
        /* V√©rification ou traitement sp√©cifique */
        return $response;
    }
}
                            </code>
                        </pre>
                        <pre class="fragment absolute fade-in" style="font-size:1.2rem">
                            <code class="full-height php" data-line-numbers="1">class AwesomeDecorator implements ClientInterface
{
    private $decorated;
    public function __construct(ClientInterface $client)
    {
        $this->decorated = $client;
    }

    public function sendRequest(RequestInterface $request): ResponseInterface
    {
        /* V√©rification ou traitement sp√©cifique */
        $response = $this->decorated->sendRequest($request);
        /* V√©rification ou traitement sp√©cifique */
        return $response;
    }
}
                            </code>
                        </pre>
                        <pre class="fragment absolute fade-in" style="font-size:1.2rem">
                            <code class="full-height php" data-line-numbers="3-7">class AwesomeDecorator implements ClientInterface
{
    private $decorated;
    public function __construct(ClientInterface $client)
    {
        $this->decorated = $client;
    }

    public function sendRequest(RequestInterface $request): ResponseInterface
    {
        /* V√©rification ou traitement sp√©cifique */
        $response = $this->decorated->sendRequest($request);
        /* V√©rification ou traitement sp√©cifique */
        return $response;
    }
}
                            </code>
                        </pre>
                        <pre class="fragment absolute fade-in" style="font-size:1.2rem">
                            <code class="full-height php" data-line-numbers="9-15">class AwesomeDecorator implements ClientInterface
{
    private $decorated;
    public function __construct(ClientInterface $client)
    {
        $this->decorated = $client;
    }

    public function sendRequest(RequestInterface $request): ResponseInterface
    {
        /* V√©rification ou traitement sp√©cifique */
        $response = $this->decorated->sendRequest($request);
        /* V√©rification ou traitement sp√©cifique */
        return $response;
    }
}
                            </code>
                        </pre>
                        <aside class="notes">
                            Avec les designs patterns, il est possible d'adapter
                            le code fourni par d√©faut aux besoins tr√®s sp√©cifiques
                            de votre application.<br/>
                            Quand vous avez besoin de faire des appels HTTP, il
                            est int√©ressant de ne pas r√©inventer la roue. Mais vous
                            voudrez surement ajouter des contr√¥les ou de la logique
                            sp√©cifique en amont ou aval.<br/>
                            Ici j'ai un petit exemple que j'utilise
                            r√©guli√®rement et qui permet de s'approcher d'un syst√®me
                            de Middleware pour ceux qui connaissent.<br/>
                            ‚ñ∂ Mon objet va impl√©menter l'interface `ClientInterface`,
                            il devient donc un client HTTP √† part enti√®re.<br/>
                            ‚ñ∂ Je dois donc impl√©menter les m√©thodes mais je choisi
                            de d√©pendre d'un autre client qui est pass√© au constructeur,
                            Mon objet devient un d√©corateur.<br/>
                            Je peux ainsi appeler mon client sans red√©finir toute
                            la logique et ajouter avant, ou apr√®s ce que j'ai besoin de faire.<br/>
                            ‚ñ∂ Mon objet reste tr√®s simple, facile √† tester et je
                            peux empiler plusieurs couches de d√©corateurs si n√©cessaire.<br/>
                            C'est d'ailleurs ce principe qui est utilis√© par HTTPlug
                            dans les diff√©rents plugins (authentification, cache, log‚Ä¶).
                        </aside>
                    </section>
                </section>
                <section>
                    <section class="invert" data-background-image="img/tests.jpg">
                        <h1 class="highlight bottom right"><span>Tester les appels HTTP üò±‚Ä¶</span></h1>
                        <p class="highlight right"><span class="fragment">‚Ä¶d√®s qu'il y a des tiers.</span></p>
                        <aside class="notes">
                            Quand on √©crit des tests, on entend souvent qu'il est compliqu√©
                            de valider les relations avec les services externes.<br/>
                            ‚ñ∂ On est typiquement dans ce contexte quand on parle d'appels
                            HTTP.<br/>
                            Globalement un test valide que s'il re√ßoit la bonne
                            r√©ponse au bon appel il devra la traiter correctement.<br/>
                            La complexit√© augmente √† ce niveau d√®s que du code d√©pend
                            d'impl√©mentation sp√©cifiques. Il faut faire des mocks,
                            comprendre les fonctions "cach√©es" dans le client‚Ä¶
                        </aside>
                    </section>
                    <section class="invert left" data-background-image="img/lego.jpg">
                        <h1 class="highlight"><span>Les interfaces √† la rescousse</span></h1>
                        <p class="highlight">
                            <span class="fragment"><code>Psr\Http\Client\ClientInterface</code></span><br/>
                            <span class="fragment"><code>Psr\Http\Message\*</code></span>
                        </p>
                        <aside class="notes">
                            Ici, on sort du contexte HTTPlug pour revenir sur les PSR.<br/>
                            Il y a une vraie dynamique ces derni√®res ann√©es autour
                            de l'assemblage de briques respectant ces recommandations.
                            HTTPlug s'inscrit dans cette dynamique.<br/>
                            Un client HTTP, une <code>Request</code>, une <code>ResponseFactory</code> ?<br/>
                            Il suffit d'injecter une impl√©mentation qui colle pour
                            que le code fonctionne. Une belle preuve de l'int√©r√™t
                            des PSRs !
                        </aside>
                    </section>
                    <section class="invert">
                        <p class="highlight"><span><code>php-http/mock-client
                        </code></span></p>
                        <pre class="absolute">
                            <code class="full-height php" data-line-numbers="1">$client = new Http\Mock\Client;

$client->on(
    new RequestMatcher('/api', 'example.com'),
    function (): ResponseInterface {
        /* Cr√©er une r√©ponse adapt√©e */
        return $response;
    }
);

$dto = (new MyApiDataRetriever($client))->retrieveData(
    $messageFactory->createRequest('GET', 'http://example.com/api')
);
                            </code>
                        </pre>
                        <pre class="fragment absolute fade-in">
                            <code class="full-height php" data-line-numbers="3-9">$client = new Http\Mock\Client;

$client->on(
    new RequestMatcher('/api', 'example.com'),
    function (): ResponseInterface {
        /* Cr√©er une r√©ponse adapt√©e */
        return $response;
    }
);

$dto = (new MyApiDataRetriever($client))->retrieveData(
    $messageFactory->createRequest('GET', 'http://example.com/api')
);
                            </code>
                        </pre>
                        <pre class="fragment absolute fade-in">
                            <code class="full-height php" data-line-numbers="4">$client = new Http\Mock\Client;

$client->on(
    new RequestMatcher('/api', 'example.com'),
    function (): ResponseInterface {
        /* Cr√©er une r√©ponse adapt√©e */
        return $response;
    }
);

$dto = (new MyApiDataRetriever($client))->retrieveData(
    $messageFactory->createRequest('GET', 'http://example.com/api')
);
                            </code>
                        </pre>
                        <pre class="fragment absolute fade-in">
                            <code class="full-height php" data-line-numbers="5-8">$client = new Http\Mock\Client;

$client->on(
    new RequestMatcher('/api', 'example.com'),
    function (): ResponseInterface {
        /* Cr√©er une r√©ponse adapt√©e */
        return $response;
    }
);

$dto = (new MyApiDataRetriever($client))->retrieveData(
    $messageFactory->createRequest('GET', 'http://example.com/api')
);
                            </code>
                        </pre>
                        <pre class="fragment absolute fade-in">
                            <code class="full-height php" data-line-numbers="11-13">$client = new Http\Mock\Client;

$client->on(
    new RequestMatcher('/api', 'example.com'),
    function (): ResponseInterface {
        /* Cr√©er une r√©ponse adapt√©e */
        return $response;
    }
);

$dto = (new MyApiDataRetriever($client))->retrieveData(
    $messageFactory->createRequest('GET', 'http://example.com/api')
);
                            </code>
                        </pre>
                        <aside class="notes">
                            ‚ñ∂ Un client d√©di√© aux tests est maintenu officiellement,
                            et permet de construire une s√©quence de traitement
                            enti√®rement fig√©e et ma√Ætris√©e. Bien sur, compatible
                            avec les PSR.<br/>
                            ‚ñ∂ Il y a plusieurs fa√ßons de l'utiliser, celle que
                            j'int√®gre le plus souvent est bas√©e sur le <code>RequestMatcher</code>.<br/>
                            ‚ñ∂ Ce <code>Matcher</code> va permettre de venir jouer
                            avec les r√©ponses √† envoyer. Votre code m√©tier fait
                            un appel, vers une URL particuli√®re, on peut capturer
                            cette requ√™te pour envoyer une r√©ponse donn√©e.<br/>
                            ‚ñ∂ Il devient assez simple de cr√©er des cas d'erreurs,
                            ou de validation. On ne d√©pend absolument pas du
                            service externe et il n'y aura pas du tout d'appel
                            r√©seau pendant les tests.<br/>
                            ‚ñ∂ On gagne sur les deux tableaux, les tests sont plus
                            rapides et ma√Ætris√©s. On obtient aussi des tests
                            idempotent car ils ne s'appuient que sur eux m√™me sans
                            changer l'impl√©mentation dans l'application.
                        </aside>
                    </section>
                </section>
<!--#########################################################################-->
                <section class="invert" data-background-image="img/power.jpg">
                    <h1 class="highlight top right"><span>Vous avez le pouvoir</span></h1>
                    <aside class="notes">
                        Maintenant vous avez une nouvelle vision des clients HTTP,
                        de leur impact et des solutions propos√©es.<br/>
                        Personnellement j'aime beaucoup la simplicit√© du code qui
                        va avec.<br/>
                        La centralisation m'a permis plusieurs fois de mieux comprendre
                        les s√©quences d'appels, d'√©changer avec mon client autour de logs
                        exhaustifs.<br/>
                        Au niveau des tests, les outils int√©gr√©s m'ont aussi permis
                        d'avoir une bonne ma√Ætrise pour valider des s√©quences de
                        traitements complexes.
                    </aside>
                </section>
                <section class="invert" data-background-image="img/thank-you.jpg">
                    <aside class="notes">
                        Merci de votre attention.
                    </aside>
                </section>
            </div>
        </div>

        <script src="../assets/reveal.js/js/reveal.js"></script>
        <script src="../assets/javascripts/mermaid.min.js"></script>

        <script>
            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: false,
                progress: true,
                history: true,
                center: true,
                pdfSeparateFragments: false,

                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
                transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: '../assets/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: '../assets/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: '../assets/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: '../assets/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: '../assets/reveal.js/plugin/zoom-js/zoom.js', async: true },
                    { src: '../assets/reveal.js/plugin/notes/notes.js', async: true }
                ]
            });

            mermaid.initialize({startOnLoad:true});
        </script>
    </body>
</html>
