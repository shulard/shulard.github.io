<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>WordPress, Git et l'intégration continue - WordCamp 2015 - Stéphane HULARD / CH Studio</title>

		<meta name="description" content="">
		<meta name="author" content="Stéphane HULARD">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="../assets/reveal.js/css/reveal.css">
		<link rel="stylesheet" href="../assets/reveal.js/css/theme/moon.css" id="theme">
		<link rel="stylesheet" href="../assets/css/font-awesome.min.css">
		<link rel="stylesheet" href="../assets/css/specific.css">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="../assets/reveal.js/lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? '../assets/reveal.js/css/print/pdf.css' : '../assets/reveal.js/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="../assets/reveal.js/lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal concave center">
			<p class="global-footer">
				<a href="http://chstudio.fr"><img src="../assets/logo.png" width="20" /></a>
				<a href="http://lyon.wordcamp.org/2015/"><img src="img/wordcamp.jpg" width="20" /></a>
				<span>2015&nbsp;-&nbsp;WordCamp Lyon / WordPress, Git et l'intégration continue</span>
			</p>

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section data-background-color="rgba( 0, 174, 239, 0.6 )">
					<h1>WordPress, Git et l'intégration continue</h1>
					<p>Retour d'expérience et outils...</p>
					<p><small>WordCamp Lyon / 5 juin 2015</small></p>
				</section>
				<section data-background-color="rgba( 0, 174, 239, 0.6 )">
					<h1>Qui suis-je ?<br/><small>Consultant technique web</small></h1>
					<p>Développements spécifiques, création de site, constitution d'équipes, accompagnement, méthodes agiles...</p>
					<p>Mon crédo, si c'est technique et web, ça m'intéresse&nbsp;<i class="fa fa-smile-o"></i></p>
					<div style="width: 40%; text-align: left; font-size: 0.7em; margin-left: 5%; display: inline-block">
						<p><span class="fa fa-building-o">&nbsp;</span> <a href="http://chstudio.fr">http://chstudio.fr</a></p>
						<p><span class="fa fa-suitcase">&nbsp;</span> <a href="mailto:s.hulard@chstudio.fr">s.hulard@chstudio.fr</a></p>
					</div>
					<div style="width: 40%; text-align: left; font-size: 0.7em; margin-left: 5%; display: inline-block">
						<p><span class="fa fa-twitter-square">&nbsp;</span> <a href="https://twitter.com/s_hulard">@s_hulard</a></p>
						<p><span class="fa fa-github-square">&nbsp;</span> <a href="http://github.com/shulard">http://github.com/shulard</a></p>
					</div>
				</section>
<!--#########################################################################-->
				<section>
					<h1>Pendant cette session...</h1>
					<div>
						<ol style="min-width: 65%; font-size: 1.3em;">
							<li>L'intégration continue ?</li>
							<li>Pourquoi avec WordPress ?</li>
							<li>Mes méthodes et outils</li>
						</ol>
					</div>
				</section>
<!--1-------------------------------------------------------------------------->
				<section class="stack">
					<section>
						<h1>L'intégration continue ?</h1>
					</section>
					<section>
						<h1>Qu'est-ce que c'est ?</h1>
						<div style="text-align: left;">
							<blockquote>Continuous Integration is a software development practice where members of a team integrate their work frequently, usually each person integrates at least daily - leading to multiple integrations per day. Each integration is verified by an automated build (including test) to detect integration errors as quickly as possible. Many teams find that this approach leads to significantly reduced integration problems and allows a team to develop cohesive software more rapidly.<br/><a href="http://www.martinfowler.com/articles/continuousIntegration.html" style="float: right">Martin Flower</a><br/></blockquote>
						</div>
					</section>
					<section>
						<h1>À quoi ça sert ?</h1>
						<div style="text-align: left;">
							<p>Donner la possibilité à :</p>
							<ul>
								<li>Une équipe de se rendre compte de ses erreurs automatiquement ;</li>
								<li>À un testeur d'avoir accès aux derniers développements automatiquement ;</li>
								<li>À un chef de projet de suivre l'évolution du travail en cours.</li>
							</ul>
						</div>
					</section>
					<section>
						<h1>Pour qui ?</h1>
						<div style="text-align: left;">
							<ul>
								<li>Les équipes de développement qui travaille sur des gros projets et qui utilisent des méthodes agiles</li>
								<li>Pratiques issues du développement logiciel, pas très facile à appliquer sur de l'intégration de sites web</li>
							</ul>
						</div>
					</section>
					<section>
						<h1>Bénéfices</h1>
						<div style="text-align: left;">
							<ul>
								<li>Amélioration de la fiabilité des développements</li>
								<li>Automatisation des tâches récurentes, ne pas perdre de temps sur des choses sans valeur ajoutée</li>
							</ul>
						</div>
					</section>
				</section>
<!--2-------------------------------------------------------------------------->
				<section class="stack">
					<section>
						<h1>Pourquoi avec WordPress ?</h1>
					</section>
					<section>
						<h1>En tant qu'indépendant</h1>
						<div style="text-align: left;">
							<p>Je ne veux pas :</p>
							<ul>
								<li>Perdre de temps à me rappeler les règles pour l'installation ;</li>
								<li>Me rappeler des plugins / outils que j'utilise à chaque fois.</li>
							</ul>
							<p>Je veux :</p>
							<ul>
								<li>Allez vite à l'essentiel, l'intégration des thèmes/plugins !</li>
							</ul>
						</div>
					</section>
					<section>
						<h1>Mais... avec WordPress ???</h1>
						<div style="text-align: left; width: 76%; margin-left: 12%">
							<p>J'entends trop souvent :</p>
							<ul>
								<li>WordPress c'est juste pour faire des blogs !</li>
								<li>WordPress c'est mal codé !</li>
								<li>WordPress c'est pas fait pour les devs !</li>
							</ul>
							<p>Alors, pourquoi des sites comme Wired.com l'utilisent ?</p>
						</div>
					</section>
					<section>
						<h1>Pour moi c'est un outil !</h1>
						<div style="text-align: left; width: 74%; margin-left: 15%">
							<p>Il faut le comprendre, le connaitre et ne pas chercher à le changer.</p>
							<p>S'il n'est pas adapté, il faut en choisir un autre...</p>
							<p>Par contre, il doit aussi être adapté à mon workflow de travail quotidien...</p>
						</div>
					</section>
					<section>
						<h1>Quelles contraintes ?</h1>
						<div style="text-align: left;">
							<ul>
								<li>Différents environnements avec différentes configurations</li>
								<ul>
									<li>Développement en local, ici tout et possible!</li>
									<li>Production sur serveur client (mutualisé, dédié, ...) on ne maitrise rien ici...</li>
								</ul>
								<li>Un cycle de vie des données (BDD, images) à gérer !</li>
							</ul>
						</div>
					</section>
				</section>
<!--3-------------------------------------------------------------------------->
				<section class="stack">
					<section>
						<h1>Mes méthodes et outils</h1>
					</section>
					<section>
						<h1>Le contrôle de version</h1>
						<div style="text-align: left;">
							<p>Je travaille principalement seul sur les projets d'intégration...</p>
							<p>... mais je l'utilise au quotidien pour tout le code que j'écris!</p>
							<ul>
								<li>Git - <a href="https://git-scm.com/">https://git-scm.com/</a> <small>(mon préféré)</small></li>
								<li>Subversion - <a href="https://subversion.apache.org/">https://subversion.apache.org/</a></li>
							</ul>
						</div>
					</section>
					<section>
						<h1>Un modèle de projet</h1>
						<div style="text-align: left;">
							<p>Je me suis créé un projet type pour l'intégration WordPress :</p>
							<ul>
								<li>Une structure duplicable très rapidement</li>
								<li>Un projet construit selon mes besoins</li>
								<li>Versionné sous Git et dispo sur GitHub</li>
							</ul>
							<p style="text-align: center;">
								<span class="fa fa-github-square">&nbsp;</span> <a href="https://github.com/CHStudio/wordpress-project">https://github.com/CHStudio/wordpress-project<sup><small>1</small></sup></a>
							</p>
							<br/>
							<ol style="font-size:0.55em; width: 100%">
								<li><a href="http://www.24joursdeweb.fr/2014/comment-bien-versionner-son-site-wordpress-avec-git-et-github/">http://www.24joursdeweb.fr/2014/comment-bien-versionner-son-site-wordpress-avec-git-et-github/</a></li>
							</ol>
						</div>
					</section>
					<section>
						<h1>L'automatisation</h1>
						<div style="text-align: left;">
							<p>J'utilise des outils pour automatiser les tâches récurentes :</p>
							<ul>
								<li>Initialisation de la configuration <code>wp-config.php</code></li>
								<li>Initialisation de la base de données</li>
								<li>Sauvegarde / Restauration des contenus (images et BDD)</li>
								<li>Gestion des différents environnements (dev, préprod, prod)</li>
							</ul>
							<p><strong>Objectif</strong>: Simplifier les tâches critiques et automatiser !
						</div>
					</section>
					<section>
						<h1>La commande est mon amie</h1>
						<div style="text-align: left;">
							<p>La plupart des outils s'utilisent en ligne de commande.</p>
							<p>Il faut apprendre à dompter le <code>terminal</code>, <code>Bash</code>, <code>SSH</code> pour qu'ils deviennent des alliés.</p>
						</div>
					</section>
					<section>
						<h1>Des besoins compliqués ...</h1>
						<div style="text-align: left;">
							<ul>
								<li>Versionning, tag, branches</li>
								<li>Imports SQL en ligne de commande</li>
								<li>RSync: Synchronisation de fichiers vers un serveur distant par SSH</li>
								<li>Validation du code (PHPLint, Behat/Mink, PHPUnit...)</li>
							</ul>
							<p>Connaitre le fonctionnement de chacun de ces outils est un cauchemar...</p>
						</div>
					</section>
					<section>
						<h1>... mais des solutions existent</h1>
						<div style="text-align: left;">
							<p>Beaucoup de monde s'est déjà posé la question, il faut se servir de leur expérience!</p>
							<p>Il faut trouver les outils adaptés et capables de manipuler :</p>
							<ul>
								<li>Un environnement PHP</li>
								<li>Git / SVN</li>
								<li>MySQL</li>
								<li>Configuration du serveur web</li>
							</ul>
						</div>
					</section>
					<section>
						<h1>Phing et WP-CLI à la rescousse</h1>
						<div style="text-align: left;">
							<p><a href="http://www.phing.info">Phing</a> est un système de build basé sur <a href="http://ant.apache.org/">Apache Ant</a> :</p>
							<ul>
								<li>Un fichier XML décrit les tâches<sup><small>1</small></sup></li>
							</ul>
							<pre style="font-size: 0.4em">
								<code class="xml">
  <project basedir="." default="help">
    <target name="env:install" description="Install current environment">
      <phingcall target="env:init"></phingcall>
      <phingcall target="wp:install"></phingcall>
    </target>
    <target name="env:wp:update" description="Update local wordpress version instance to the most recent one">
      <exec command="cd public/wp-cms &amp;&amp; git fetch --tags &amp;&amp; git checkout `git tag | tail -1`"></exec>
    </target>
    <target name="env:backup" description="Restore backuped date in the current environement">
      <phingcall target="db:backup"></phingcall>
      <phingcall target="wp:uploads:backup"></phingcall>
    </target>
  </project>
								</code>
							</pre>
							<ol style="font-size:0.6em; width: 100%">
								<li><a href="https://github.com/CHStudio/wordpress-project/blob/develop/build.xml">https://github.com/CHStudio/wordpress-project/blob/develop/build.xml</a></li>
							</ol>
						</div>
					</section>
					<section>
						<h1>Phing et WP-CLI à la rescousse</h1>
						<div style="text-align: left;">
							<p><a href="http://wp-cli.org/">WP-CLI</a> est une série de commandes pour gérer les installations WordPress :</p>
							<ul>
								<li>Ajout d'utilisateurs, gestion des droits</li>
								<li>Gestion de termes, des posts, des thèmes, des sidebars...</li>
								<li>Tout ça en ligne de commande <i class="fa fa-smile-o"></i></li>
							</ul>
							<pre>
								<code class="bash">
  $ bin/wp export
  $ bin/wp is-installed
  $ bin/wp install --url="http://monsite.com" --title="un super site !"
  $ bin/wp post create
  $ bin/wp rewrite list
								</code>
							</pre>
						</div>
					</section>
					<section>
						<h1>Phing et WP-CLI à la rescousse</h1>
						<div>
							<p>Ces tâches sont agrégées pour simplifier</p>
							<pre>
								<code class="bash">
  $ phing env:init		-> Générer la configuration
  $ phing env:install		-> Initialser configuration et BDD
  $ phing db:backup		-> Créer un dump de la BDD au format SQL
  $ phing wp:uploads:restore	-> Restaurer une archive des images
  $ phing sync:execute		-> Synchroniser un environnement distant
								</code>
							</pre>
						</div>
					</section>
					<section>
						<h1>Dépendances avec Composer</h1>
						<div style="width: 94%; margin-left: 3%">
							<p>Quels outils, dans quelles versions, sont utiles au projet ?</p>
							<pre style="font-size: 0.5em">
								<code class="json">
  {
  	"name": "chstudio/wordpress-project",
  	"description": "A sample initialization project for WordPress website",
  	"license": "Apache-2.0",
  	"authors": [
  		{ "name": "Stephane HULARD", "email": "s.hulard@chstudio.fr" }
  	],
  	"config": {
  		"bin-dir": "bin"
  	},
  	"require": {},
  	"require-dev": {
  		"phing/phing": "2.*",
  		"wp-cli/wp-cli": "0.*"
  	}
  }

								</code>
							</pre>
						</div>
					</section>
					<section>
						<h1>Installation avec Composer</h1>
						<div style="text-align: left; width: 70%; margin-left: 15%">
							<p>Une commande pour les trouver !<br/>
							Une commande pour les amener tous !<br/>
							Et dans un projet les lier...</p>
						</div>
						<div style="width: 96%; margin-left: 2%">
							<pre style='font-size: 0.5em'>
								<code class="bash">
  # En local
  $ composer install

  # En production
  $ composer install --no-dev --optimize-autoloader --prefer-dist --no-interaction
								</code>
							</pre>
							<p><i class="fa fa-warning"></i>&nbsp;Le fichier <code>composer.lock</code> doit être versionné!</p>
						</div>
					</section>
					<section>
						<h1>Git branching model</h1>
						<div style="text-align: left; width: 50%; display: inline-block; vertical-align: top;">
							<p>Structurer et normaliser le flux de développement avec git: Git Flow</p>
							<ul>
								<li>Développement</li>
								<li>Releases</li>
								<li>Production</li>
								<li>Maintenance</li>
							</ul>
						</div>
						<div style="text-align: left; width: 45%; display: inline-block">
							<img src="img/git-flow.png" />
						</div>
					</section>
					<section>
						<h1>Et HOP dans le Cloud !</h1>
						<div>
							<p>J'utilise <a href="https://gitlab.com">GitLab</a> pour gérer mes dépôts clients, gratuit et avec la possibilité de créer des dépôts privés !</p>
							<img src="img/gitlab.jpg" />
						</div>
					</section>
					<section>
						<h1>GitLab</h1>
						<div style="text-align: left">
							<ul>
								<li>Des dépôts centralisés et accessibles en HTTP / SSH</li>
								<li>Installation simplifiée et accès sécurisé par clé SSH</li>
								<li>Gestion des tickets</li>
								<li>Sauvegarde du code source des projets <i class="fa fa-smile-o"></i></li>
							</ul>
							<p>Récupérer les sources et installer le projet :</p>
							<pre style="font-size: 0.43em">
								<code class="bash">
  $ git clone
  $ composer install --no-dev --optimize-autoloader --prefer-dist --no-interaction
  $ bin/phing env:install --Dbuild.env=PROD
  $ bin/phing db:restore --Dbuild.env=PROD
  $ bin/phing wp:uploads:restore --Dbuild.env=PROD
  $ bin/phing wp:migrate --Ddomain.previous=http://monsite.dev --Ddomain.previous=http://monsite.com
								</code>
							</pre>
						</div>
					</section>
					<section>
						<h1>GitLab CI</h1>
						<div style="text-align: left">
							<ul>
								<li>Plateforme d'intégration continue gratuite dans <a href="https://gitlab.com">GitLab</a></li>
								<li>Un <code>build</code> est généré pour chaque commit sur le projet</li>
							</ul>
							<img src="img/gitlab-ci.jpg" />
						</div>
					</section>
					<section>
						<h1>GitLab CI: Un build ?</h1>
						<div style="text-align: left;">
							<p>Un build est une série d'étapes totalement automatisées, qui seront exécutées sur chaque commit.</p>
							<p>Il permet de faire tout ce qui est nécessaire :</p>
							<ul>
								<li>Tests unitaires et fonctionnels</li>
								<li>Validation du code (<code>PHP CodeSniffer</code> par exemple)</li>
								<li>Déploiement automatique en cas de succès <i class="fa fa-smile-o"></i></li>
							</ul>
							<p>Le projet devient autonome...</p>
						</div>
					</section>
					<section>
						<h1>GitLab CI: Liste des builds</h1>
						<div>
							<ul>
								<li>Visualisation de l'état de chaque commit</li>
								<li>Accès au statistiques sur le projet</li>
							</ul>
							<img src="img/gitlab-ci-build.jpg" />
						</div>
					</section>
					<section>
						<h1>GitLab CI: Log d'un build</h1>
						<div>
							<ul>
								<li>Visualisation du retour d'exécution des commandes</li>
								<li>Utile pour savoir d'ou vient le soucis</li>
							</ul>
							<img src="img/gitlab-ci-log.jpg" />
						</div>
					</section>
					<section>
						<h1>Un couple efficace</h1>
						<div>
							<ul>
								<li>L'intégration native entre les deux plateformes simplifie fortement l'installation...</li>
								<li>Les builds peuvent être exécutés n'importe où :</li>
								<ul>
									<li>Pas nécessaire d'avoir un serveur</li>
									<li>Lancement en local très simple</li>
								</ul>
							</ul>
						</div>
					</section>
					<section>
						<h1>D'autres solutions existes</h1>
						<div>
							<ul>
								<li>Jenkins: <a href="http://jenkins-ci.org/">http://jenkins-ci.org/</a></li>
								<li>PHPCI: <a href="https://www.phptesting.org/">https://www.phptesting.org/</a></li>
								<li>Travis CI: <a href="https://travis-ci.org/">https://travis-ci.org/</a></li>
								<li>...</li>
							</ul>
							<p>De nouvelles contraintes et possibilités, il faut les étudier !</p>
						</div>
					</section>
				</section>
<!--#########################################################################-->
				<section data-background-color="rgba( 0, 174, 239, 0.6 )">
					<h1>Merci pour votre attention !<br/><small>Des questions ?</small></h1>
					<p><small><a href="http://shulard.github.io/slides/wordcamp-lyon-2015">http://shulard.github.io/slides/wordcamp-lyon-2015</a></small></p>
				</section>
			</div>

		</div>

		<script src="../assets/reveal.js/lib/js/head.min.js"></script>
		<script src="../assets/reveal.js/js/reveal.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: '../assets/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: '../assets/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '../assets/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '../assets/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: '../assets/reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: '../assets/reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

		<script>
			(function() {
				var a = document.querySelectorAll('section:not([class~=stack])');
				for( var i = 1; i < a.length+1; i++ ) {
					a[i-1].setAttribute('data-slide', i);
				}
				// Fires each time a new slide is activated
				Reveal.addEventListener( 'slidechanged', function( event ) {
					if( event.indexh !== 0 ) {
			    	document.querySelector(".slide-number").innerHTML = event.currentSlide.getAttribute('data-slide');
			    } else {
			    	document.querySelector(".slide-number").innerHTML = "";
			    }
				} );
			})();
		</script>
	</body>
</html>